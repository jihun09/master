{"version":3,"kind":"Notebook","sha256":"0d2eb90aee5b774bf4d3f06262677de1d1f9f25d365bfaec54af691100737548","slug":"labs.lab-3-tutorial","location":"/labs/Lab 3 - Tutorial.ipynb","dependencies":[],"frontmatter":{"title":"Lab 4: Data engineering pipelines with scikit-learn","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"github":"https://github.com/ml-course/master","copyright":"2025. CC0 Licensed - Use as you like. Appropriate credit is very welcome","numbering":{"title":{"offset":1}},"source_url":"https://github.com/ml-course/master/blob/master/labs/Lab 3 - Tutorial.ipynb","edit_url":"https://github.com/ml-course/master/edit/master/labs/Lab 3 - Tutorial.ipynb","thumbnail":"/82d1f6f13cd4350f3aa6a3a655364082.png","thumbnailOptimized":"/82d1f6f13cd4350f3aa6a3a655364082.webp","exports":[{"format":"ipynb","filename":"Lab 3 - Tutorial.ipynb","url":"/Lab 3 - Tutorial-c9d67c27320cf9091e00a3dfc317bcfd.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","data":{"hide_input":false,"slideshow":{"slide_type":"skip"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Auto-setup when running on Google Colab\nif 'google.colab' in str(get_ipython()):\n    !pip install openml\n\n# General imports\n%matplotlib inline\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport openml as oml\nimport seaborn as sns","key":"JcbVJ7Q2P5"},{"type":"outputs","id":"pbvqeRcWPFVnF-MzRsCOy","children":[],"key":"sAJ98H9On2"}],"key":"Fkt6LuTsuc"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Applying data transformations (recap from lecture)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IVr1Qvo7F4"}],"identifier":"applying-data-transformations-recap-from-lecture","label":"Applying data transformations (recap from lecture)","html_id":"applying-data-transformations-recap-from-lecture","implicit":true,"key":"rDFxrzbuwW"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Data transformations should always follow a ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"iw6Y0IN6IL"},{"type":"inlineCode","value":"fit-predict","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Ax3VpYYwXT"},{"type":"text","value":" paradigm","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"OG1BJmkB0d"}],"key":"LTuh3Gh5Sn"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"Fit","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"KUSlTJeluP"},{"type":"text","value":" the transformer on the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Nu5L1lUCrY"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"training data","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ANpHBVEtRz"}],"key":"kFoXlPMbyq"},{"type":"text","value":" only","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"bXQa7lopaZ"}],"key":"g32AalU16E"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"E.g. for a standard scaler: record the mean and standard deviation","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"srYAO2kbL6"}],"key":"waHt1WPZVQ"}],"key":"a38BwAhXvR"}],"key":"byGpvWgeng"}],"key":"C2Ad9o60X2"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Transform (e.g. scale) the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"WVavsfMQKi"},{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"training data","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"VIn3AHB05i"}],"key":"Q1k5aavHCS"},{"type":"text","value":", then train the learning model","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"MBvuG80T0v"}],"key":"xZfNqX2hxS"}],"key":"tyxY4j2u3D"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Transform (e.g. scale) the ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"C0UiENeXY9"},{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"test data","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"KMFd5HCLGz"}],"key":"sF4DIhB7VN"},{"type":"text","value":", then evaluate the model","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"dIauu6vapm"}],"key":"SCuNhyBpu6"}],"key":"Fnq8MsZhK7"}],"key":"mLXgR3M006"}],"key":"LjrjyTBwJH"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Only scale the input features (X), not the targets (y)!","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"eiQ7GZ8oC5"}],"key":"YBINBIuaZo"}],"key":"uOcGHOOcCd"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"If you fit and transform the whole dataset before splitting, you get ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"neGbemaMZ7"},{"type":"strong","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"data leakage","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"iGHmkZcPZ4"}],"key":"xD1oyZuAqm"}],"key":"TCrYzpQL31"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"You have looked at the test data before training the model","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"v7sJL9Xkny"}],"key":"RxgZ1SvEQx"}],"key":"aCPDFqGSkU"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Model evaluations will be misleading","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"Y60Fv7IyRA"}],"key":"bR6A8EarxD"}],"key":"IWhVhkC5Wc"}],"key":"tNvAjeHO4y"}],"key":"PuwmLhKyAR"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"If you fit and transform the training and test data separately, you distort the data","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"B9sxc85Ybo"}],"key":"uNnKhKVP51"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"E.g. training and test points are scaled differently","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"zQsMVcQzN4"}],"key":"yyuxB9JhCH"}],"key":"ZNWVobCaoJ"}],"key":"qJ3zgqzFJr"}],"key":"YQieQlrTtM"}],"key":"U7EChJzuga"}],"key":"dGyrik0ALv"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"In practice (scikit-learn)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"a37e7H5YfN"}],"identifier":"in-practice-scikit-learn","label":"In practice (scikit-learn)","html_id":"in-practice-scikit-learn","implicit":true,"key":"YOieREZGoV"},{"type":"code","lang":"python","value":"# choose scaling method and fit on training data\nscaler = StandardScaler()\nscaler.fit(X_train)\n\n# transform training and test data\nX_train_scaled = scaler.transform(X_train)\nX_test_scaled = scaler.transform(X_test)","position":{"start":{"line":3,"column":1},"end":{"line":11,"column":1}},"key":"mQfhIQui9N"}],"key":"fP6lKnjeqj"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Alternative:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"n3IZeKwPyN"}],"key":"HEK5iBWUdh"},{"type":"code","lang":"python","value":"# calling fit and transform in sequence\nX_train_scaled = scaler.fit(X_train).transform(X_train)\n# same result, but more efficient computation\nX_train_scaled = scaler.fit_transform(X_train)","position":{"start":{"line":3,"column":1},"end":{"line":8,"column":1}},"key":"Z3lewVQiv8"}],"key":"s0AFeoAt2u"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Scikit-learn processing pipelines","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"djHuaR69vO"}],"identifier":"scikit-learn-processing-pipelines","label":"Scikit-learn processing pipelines","html_id":"scikit-learn-processing-pipelines","implicit":true,"key":"eieob9xtOO"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Scikit-learn pipelines have a ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Uph3w7gzkT"},{"type":"inlineCode","value":"fit","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"gALMmWYW4s"},{"type":"text","value":", ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"JaB3OmQS09"},{"type":"inlineCode","value":"predict","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"pFqdYSgSQo"},{"type":"text","value":", and ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"CwvJKE2aSd"},{"type":"inlineCode","value":"score","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"D7M0Yc9mOZ"},{"type":"text","value":" method","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"cv8BHCOTgX"}],"key":"Rgrlhvw1Ww"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Internally applies transformations correctly","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"bmC9oryo1P"}],"key":"oUqxim2TCw"}],"key":"EltdoxDYTz"}],"key":"k1qMxcn6mL"}],"key":"d1pp2bTmXn"}],"key":"ckBU4aEKtH"},{"type":"image","style":{"width":"600px"},"url":"/82d1f6f13cd4350f3aa6a3a655364082.png","alt":"ml","key":"Hw9d1rkiSV","urlSource":"https://raw.githubusercontent.com/ML-course/master/master/notebooks/images/07_pipelines.png","urlOptimized":"/82d1f6f13cd4350f3aa6a3a655364082.webp"}],"key":"zD0vVRxdL2"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Building Pipelines","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"d8zDWXv1nr"}],"identifier":"building-pipelines","label":"Building Pipelines","html_id":"building-pipelines","implicit":true,"key":"u6000HmR9J"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"In scikit-learn, a ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"YUpDMHZQJJ"},{"type":"inlineCode","value":"pipeline","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"sjJfDGKdEz"},{"type":"text","value":" combines multiple processing ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Ifcy2bPIIj"},{"type":"emphasis","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"steps","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"BEjhbXxnNO"}],"key":"hIOBt1ek9h"},{"type":"text","value":" in a single estimator","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"kdXZQNiRM2"}],"key":"WE8YXn2Biu"}],"key":"DsMlY6YCiw"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"All but the last step should be transformer (have a ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"EUA298SwQX"},{"type":"inlineCode","value":"transform","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"TtK6fabwtT"},{"type":"text","value":" method)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"PUwEzJlesB"}],"key":"Z2htJGwRwY"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The last step can be a transformer too (e.g. Scaler+PCA)","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Sm8LY09FYY"}],"key":"SaNtuUKtjS"}],"key":"mB7Q4lWlU4"}],"key":"sA2RxZwVkf"}],"key":"bVdEFdTQmr"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"It has a ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"WjqkjiI59N"},{"type":"inlineCode","value":"fit","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"PXgcXQ6fZl"},{"type":"text","value":", ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"kxqxu6nCds"},{"type":"inlineCode","value":"predict","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"v8U5QfktZo"},{"type":"text","value":", and ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Iupf4VwEbJ"},{"type":"inlineCode","value":"score","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"mbLFLrUBic"},{"type":"text","value":" method, just like any other learning algorithm","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"eVGm2iqT40"}],"key":"TLeWLCJtuj"}],"key":"fC5FG0CI4K"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Pipelines are built as a list of steps, which are (name, algorithm) tuples","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"ZneXoLrM6o"}],"key":"FxuMu9DPK2"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The name can be anything you want, but can’t contain ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"v5JVUvFNJ8"},{"type":"inlineCode","value":"'__'","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"SNShklEdvt"}],"key":"F8TBeqNyF1"}],"key":"AxnKPSg0xK"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"We use ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"JlarjuAokS"},{"type":"inlineCode","value":"'__'","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"pLz7fwPllV"},{"type":"text","value":" to refer to the hyperparameters, e.g. ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"nHsQjqH4A4"},{"type":"inlineCode","value":"svm__C","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"BgU3HNtwLb"}],"key":"mcABNXBhj5"}],"key":"BgrdqJyQ49"}],"key":"dTfGnD5oVJ"}],"key":"SPQahPmPZf"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Let’s build, train, and score a ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"ygDqwHqO83"},{"type":"inlineCode","value":"MinMaxScaler","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"ts2ad8dfZY"},{"type":"text","value":" + ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"YKyAAdv6K8"},{"type":"inlineCode","value":"LinearSVC","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"jnj7dFxRyN"},{"type":"text","value":" pipeline:","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"xkJjXxshNq"}],"key":"NDSOtavlnR"}],"key":"hDJsBEJOFD"}],"key":"Mnax90m7wG"}],"key":"u9hYaTVYF2"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"code","lang":"python","value":"pipe = Pipeline([(\"scaler\", MinMaxScaler()), (\"svm\", LinearSVC())])\npipe.fit(X_train, y_train).score(X_test, y_test)","position":{"start":{"line":1,"column":1},"end":{"line":4,"column":1}},"key":"BE7pPGnvYr"}],"key":"KVaIxSbvWk"},{"type":"block","kind":"notebook-code","data":{"slideshow":{"slide_type":"-"}},"children":[{"type":"code","lang":"python","executable":true,"value":"from sklearn.pipeline import Pipeline\nfrom sklearn.preprocessing import MinMaxScaler\nfrom sklearn.svm import LinearSVC\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.datasets import load_breast_cancer\n\ncancer = load_breast_cancer()\npipe = Pipeline([(\"scaler\", MinMaxScaler()), (\"svm\", LinearSVC())])\n\nX_train, X_test, y_train, y_test = train_test_split(cancer.data, cancer.target,\n                                                    random_state=1)\npipe.fit(X_train, y_train)\nprint(\"Test score: {:.2f}\".format(pipe.score(X_test, y_test)))","key":"nHDdQ9HWjf"},{"type":"outputs","id":"Tslw1431gN7uii5wawrYU","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Test score: 0.97\n"},"children":[],"key":"uIQnDGh5jF"}],"key":"XwNwDKLflz"}],"key":"dwGG3t5KNX"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"-"}},"children":[{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Now with cross-validation:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jPqo23jkjg"}],"key":"Qjpf7IrUi4"}],"key":"wsc3iqUaxD"}],"key":"QdFt1CYBYJ"},{"type":"code","lang":"python","value":"scores = cross_val_score(pipe, cancer.data, cancer.target)","position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"key":"oxXecb7nhm"}],"key":"LN4Wykr8Dv"},{"type":"block","kind":"notebook-code","data":{"hide_input":true},"children":[{"type":"code","lang":"python","executable":true,"value":"from sklearn.model_selection import cross_val_score\nscores = cross_val_score(pipe, cancer.data, cancer.target)\nprint(\"Cross-validation scores: {}\".format(scores))\nprint(\"Average cross-validation score: {:.2f}\".format(scores.mean()))","key":"Ky60KpWvcv"},{"type":"outputs","id":"_ej3LxqOCuF3D1CQJf3pe","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Cross-validation scores: [0.98245614 0.97368421 0.96491228 0.96491228 0.99115044]\nAverage cross-validation score: 0.98\n"},"children":[],"key":"fodXqn52Qk"}],"key":"R3eTJYKvlP"}],"key":"o71wknoP81"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"We can retrieve the trained SVM by querying the right step indices","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"D7j1huTkjW"}],"key":"MX3MAdB5pQ"}],"key":"qvIAV7JPk9"}],"key":"a7Gre9YALx"},{"type":"code","lang":"python","value":"pipe.steps[1][1]","position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"key":"zNmFieR94T"}],"key":"vFI4JCqMWH"},{"type":"block","kind":"notebook-code","data":{"hide_input":true},"children":[{"type":"code","lang":"python","executable":true,"value":"pipe.fit(X_train, y_train)\nprint(\"SVM component: {}\".format(pipe.steps[1][1]))","key":"Lyg2SB5umG"},{"type":"outputs","id":"d7T5HdGv0PyoWObNbNtSL","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"SVM component: LinearSVC()\n"},"children":[],"key":"K4zQ7rsykw"}],"key":"P4lIc7Jqss"}],"key":"z3m5eKaXXT"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"-"}},"children":[{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Or we can use the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"a05SPVOGiB"},{"type":"inlineCode","value":"named_steps","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xDNVIA8MzZ"},{"type":"text","value":" dictionary","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"a7qdZ33k40"}],"key":"lg147nTAq7"}],"key":"xPJt9rxNKJ"}],"key":"u1MqCPaTL1"},{"type":"code","lang":"python","value":"pipe.named_steps['svm']","position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"key":"KXsa78UeYm"}],"key":"HyjBeXy3JS"},{"type":"block","kind":"notebook-code","data":{"hide_input":true},"children":[{"type":"code","lang":"python","executable":true,"value":"print(\"SVM component: {}\".format(pipe.named_steps['svm']))","key":"Go9xYkO4nP"},{"type":"outputs","id":"WuiDohMmXVoBRfR5X7tYH","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"SVM component: LinearSVC()\n"},"children":[],"key":"x60vajPn1g"}],"key":"rrQIeBw6Zs"}],"key":"QTTfIFL1CC"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"When you don’t need specific names for specific steps, you can use ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ha9jddBTND"},{"type":"inlineCode","value":"make_pipeline","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"G3S7lK24SI"}],"key":"kgs7Xszbyw"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Assigns names to steps automatically","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"SktoIjh3Bg"}],"key":"e3N526Z0bR"}],"key":"WYsl9AHV6c"}],"key":"g4rnVnNbhA"}],"key":"BneMZX1Rni"}],"key":"muEuPuBXbp"},{"type":"code","lang":"python","value":"pipe_short = make_pipeline(MinMaxScaler(), LinearSVC(C=100))\nprint(\"Pipeline steps:\\n{}\".format(pipe_short.steps))","position":{"start":{"line":3,"column":1},"end":{"line":6,"column":1}},"key":"h1VxSyuPli"}],"key":"eFl9D54OD6"},{"type":"block","kind":"notebook-code","data":{"hide_input":true},"children":[{"type":"code","lang":"python","executable":true,"value":"from sklearn.pipeline import make_pipeline\n# abbreviated syntax\npipe_short = make_pipeline(MinMaxScaler(), LinearSVC(C=100))\nprint(\"Pipeline steps:\\n{}\".format(pipe_short.steps))","key":"Ae1xQYe80o"},{"type":"outputs","id":"yWggI_4-6ITgBxUrTXw_m","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Pipeline steps:\n[('minmaxscaler', MinMaxScaler()), ('linearsvc', LinearSVC(C=100))]\n"},"children":[],"key":"UxU0Q2nFUl"}],"key":"LprK5nlnqz"}],"key":"ulNTjTcwSW"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Visualization of a pipeline ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bnRhtQZZhx"},{"type":"inlineCode","value":"fit","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mIxpSExxNn"},{"type":"text","value":" and ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"P4lOIpGDNc"},{"type":"inlineCode","value":"predict","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"G5kyv2cOq0"}],"key":"wEWGjzf7B3"}],"key":"c4jLUwmXoN"},{"type":"block","kind":"notebook-content","children":[{"type":"image","style":{"width":"700px"},"url":"/82d1f6f13cd4350f3aa6a3a655364082.png","alt":"ml","key":"Ew1UOQ2FOf","urlSource":"https://raw.githubusercontent.com/ML-course/master/master/notebooks/images/07_pipelines.png","urlOptimized":"/82d1f6f13cd4350f3aa6a3a655364082.webp"}],"key":"mhvUSMTapV"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Pipeline selection","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"U3R2it4wd9"}],"identifier":"pipeline-selection","label":"Pipeline selection","html_id":"pipeline-selection","implicit":true,"key":"h0cskArVed"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"We can safely use pipelines in model selection (e.g. grid search)","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"l8pMSVpDiy"}],"key":"VpsfFEQzNk"}],"key":"mZH6aJ6aJS"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Use ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"EiKb19lWyk"},{"type":"inlineCode","value":"'__'","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"HbK8aXtkhh"},{"type":"text","value":" to refer to the hyperparameters of a step, e.g. ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"luvJ8oBzhd"},{"type":"inlineCode","value":"svm__C","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"p64NhVmKqx"}],"key":"oS3TxXYKmp"}],"key":"Z5zFKQihyL"}],"key":"Vzm1TNc0vT"},{"type":"code","lang":"python","value":"# Correct grid search (can have hyperparameters of any step)\nparam_grid = {'svm__C': [0.001, 0.01],\n              'svm__gamma': [0.001, 0.01, 0.1, 1, 10, 100]}\ngrid = GridSearchCV(pipe, param_grid=param_grid).fit(X,y)\n# Best estimator is now the best pipeline\nbest_pipe = grid.best_estimator_\n\n# Tune pipeline and evaluate on held-out test set\ngrid = GridSearchCV(pipe, param_grid=param_grid).fit(X_train,y_train)\ngrid.score(X_test,y_test)\n","position":{"start":{"line":5,"column":1},"end":{"line":17,"column":1}},"key":"bcr3Ewo5Rk"}],"key":"KN45gJLbuP"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Using Pipelines in Grid-searches","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CXyKNNUFby"}],"identifier":"using-pipelines-in-grid-searches","label":"Using Pipelines in Grid-searches","html_id":"using-pipelines-in-grid-searches","implicit":true,"key":"Hk6SYcYczV"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"We can use the pipeline as a single estimator in ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"cxsdJ3NTGC"},{"type":"inlineCode","value":"cross_val_score","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"GGBq4CtCNu"},{"type":"text","value":" or ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"qukjwFTF6A"},{"type":"inlineCode","value":"GridSearchCV","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"qSARe4IKz7"}],"key":"yjn84ZOPJ2"}],"key":"flC3a1Rwm3"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"To define a grid, refer to the hyperparameters of the steps","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"r1evhpxpmM"}],"key":"QLw8uIYiXg"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Step ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"WAU6uBPfXL"},{"type":"inlineCode","value":"svm","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"MaGjOPAoAh"},{"type":"text","value":", parameter ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"IxOzK6hk8l"},{"type":"inlineCode","value":"C","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"oVuMoVV5yZ"},{"type":"text","value":" becomes ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"GY4sdTNroS"},{"type":"inlineCode","value":"svm__C","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"x6uMBwHbnO"}],"key":"ltC5E11Rk7"}],"key":"GD5ZTbrVXo"}],"key":"n2VT3GQnGf"}],"key":"YJxG5UPW46"}],"key":"aNsrVEH8nE"}],"key":"SDpW9a8s0B"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"param_grid = {'svm__C': [0.001, 0.01, 0.1, 1, 10, 100],\n              'svm__gamma': [0.001, 0.01, 0.1, 1, 10, 100]}","key":"TzNEqAwX3T"},{"type":"outputs","id":"0M4pB1LyxX8K3SxPmBEUc","children":[],"key":"miFDzy9KFc"}],"key":"Ftw0pfxoUH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from sklearn import pipeline\nfrom sklearn.svm import SVC\nfrom sklearn.model_selection import GridSearchCV\n\npipe = pipeline.Pipeline([(\"scaler\", MinMaxScaler()), (\"svm\", SVC(C=100))])\ngrid = GridSearchCV(pipe, param_grid=param_grid, cv=5)\ngrid.fit(X_train, y_train)\nprint(\"Best cross-validation accuracy: {:.2f}\".format(grid.best_score_))\nprint(\"Test set score: {:.2f}\".format(grid.score(X_test, y_test)))\nprint(\"Best parameters: {}\".format(grid.best_params_))","key":"sfsuyBiTuJ"},{"type":"outputs","id":"8ipraD0ADg-XqF0xaei1F","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Best cross-validation accuracy: 0.97\nTest set score: 0.97\nBest parameters: {'svm__C': 10, 'svm__gamma': 1}\n"},"children":[],"key":"TRedlcmh2P"}],"key":"OH40ExSLaw"}],"key":"Phk5ghCnWy"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"When we request the best estimator of the grid search, we’ll get the best pipeline","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Cv7SvWMlET"}],"key":"kI7yB03t3d"}],"key":"K0IR9J8frV"}],"key":"wwvKX1hkUD"},{"type":"code","lang":"python","value":"grid.best_estimator_","position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"key":"jsFkKp6Wv0"}],"key":"Rnmi3s6sxY"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(\"Best estimator:\\n{}\".format(grid.best_estimator_))","key":"IjFwfDyC23"},{"type":"outputs","id":"J4OwkRhTJdMjsWj8nP238","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Best estimator:\nPipeline(steps=[('scaler', MinMaxScaler()), ('svm', SVC(C=10, gamma=1))])\n"},"children":[],"key":"ICpF5ODhbX"}],"key":"rPdlytoj94"}],"key":"n5zIBWhZyA"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"-"}},"children":[{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"And we can drill down to individual components and their properties","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rFyzz46hJp"}],"key":"bWmzXSDiNQ"}],"key":"cpWGSWabsb"}],"key":"lSPzALhmcB"},{"type":"code","lang":"python","value":"grid.best_estimator_.named_steps[\"svm\"]","position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"key":"jxjV4EYDN0"}],"key":"EwGEZ30n6l"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Get the SVM\nprint(\"SVM step:\\n{}\".format(\n      grid.best_estimator_.named_steps[\"svm\"]))","key":"HaTuCkmx9P"},{"type":"outputs","id":"CgebdjJdB6WTSD1rMvFZO","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"SVM step:\nSVC(C=10, gamma=1)\n"},"children":[],"key":"uuaKrGSZHj"}],"key":"HVqximzf1E"}],"key":"RMkObG2fau"},{"type":"block","kind":"notebook-code","data":{"slideshow":{"slide_type":"skip"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# Get the SVM dual coefficients (support vector weights)\nprint(\"SVM support vector coefficients:\\n{}\".format(\n      grid.best_estimator_.named_steps[\"svm\"].dual_coef_))","key":"u6qnkTCGgA"},{"type":"outputs","id":"8DCeWimsu85zdHFef2ZHu","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"SVM support vector coefficients:\n[[ -1.39188844  -4.06940593  -0.435234    -0.70025696  -5.86542086\n   -0.41433994  -2.81390656 -10.         -10.          -3.41806527\n   -7.90768285  -0.16897821  -4.29887055  -1.13720135  -2.21362118\n   -0.19026766 -10.          -7.12847723 -10.          -0.52216852\n   -3.76624729  -0.01249056  -1.15920579 -10.          -0.51299862\n   -0.71224989 -10.          -1.50141938 -10.          10.\n    1.99516035   0.9094081    0.91913684   2.89650891   0.39896365\n   10.           9.81123374   0.4124202   10.          10.\n   10.           5.41518257   0.83036405   2.59337629   1.37050773\n   10.           0.27947936   1.55478824   6.58895182   1.48679571\n   10.           1.15559387   0.39055347   2.66341253   1.27687797\n    0.65127305   1.84096369   2.39518826   2.50425662]]\n"},"children":[],"key":"bho0KxSY60"}],"key":"mtyqnZxH63"}],"key":"gE7mdUTZSl"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Grid-searching preprocessing steps and model parameters","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LQn4ZakD7J"}],"identifier":"grid-searching-preprocessing-steps-and-model-parameters","label":"Grid-searching preprocessing steps and model parameters","html_id":"grid-searching-preprocessing-steps-and-model-parameters","implicit":true,"key":"j3tK9NYQAE"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"We can use grid search to optimize the hyperparameters of our preprocessing steps and learning algorithms at the same time","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"z03UzTw0KG"}],"key":"JPyY23n1gs"}],"key":"Ltd5WEr28e"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Consider the following pipeline:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"DMGl54OA7A"}],"key":"XVqwIc99S4"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"StandardScaler","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"VNleu2Gzfc"},{"type":"text","value":", without hyperparameters","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"DlsUyA4V5P"}],"key":"oKiGWxR2Kr"}],"key":"vxowbRNS3T"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"PolynomialFeatures","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"SH1MUIHHiT"},{"type":"text","value":", with the max. ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"WHWMKzWgQo"},{"type":"emphasis","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"degree","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Iyg0eo0ffP"}],"key":"xpc7Cp5pnH"},{"type":"text","value":" of polynomials","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"srgUiZVTAE"}],"key":"mwRfqJM1ro"}],"key":"LH60Fz2jHk"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"Ridge","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"KMsiYwcaOH"},{"type":"text","value":" regression, with L2 regularization parameter ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"jX6pOUjMbx"},{"type":"emphasis","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"alpha","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"c6WApuAPqE"}],"key":"lgwEtwg9I3"}],"key":"buS5reVUev"}],"key":"bsVFfTuztO"}],"key":"v3smtC20jO"}],"key":"Jy3ZvGegdc"}],"key":"jPpHuyvsCl"}],"key":"ZFg8RPVieK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from sklearn.datasets import fetch_california_housing\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.linear_model import Ridge\n\nhousing = fetch_california_housing()\nX_train, X_test, y_train, y_test = train_test_split(housing.data, housing.target,\n                                                    random_state=0)\nfrom sklearn.preprocessing import PolynomialFeatures\npipe = pipeline.make_pipeline(\n    StandardScaler(),\n    PolynomialFeatures(),\n    Ridge())","key":"jBjAxwyboq"},{"type":"outputs","id":"qrUb5ZyflyxPYGhnuaYS7","children":[],"key":"r4YdOtXWYQ"}],"key":"QuYXDB0p1Q"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"We don’t know the optimal polynomial degree or alpha value, so we use a grid search (or random search) to find the optimal values","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BczKuqHKnu"}],"key":"xrL5FBBCQr"}],"key":"nIg1jw3AFV"}],"key":"eYzQg74jOP"},{"type":"code","lang":"python","value":"param_grid = {'polynomialfeatures__degree': [1, 2, 3],\n              'ridge__alpha': [0.001, 0.01, 0.1, 1, 10, 100]}\ngrid = GridSearchCV(pipe, param_grid=param_grid, cv=5, n_jobs=1)\ngrid.fit(X_train, y_train)","position":{"start":{"line":2,"column":1},"end":{"line":7,"column":1}},"key":"mPsE1J24X6"}],"key":"twMQvyD0OQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"param_grid = {'polynomialfeatures__degree': [1, 2, 3],\n              'ridge__alpha': [0.001, 0.01, 0.1, 1, 10, 100]}\n# Note: I had to use n_jobs=1. (n_jobs=-1 stalls on my machine)\ngrid = GridSearchCV(pipe, param_grid=param_grid, cv=5, n_jobs=1)\ngrid.fit(X_train, y_train);","key":"oyi6vcrXyV"},{"type":"outputs","id":"yF9PqU1ucqKBapT5dF_vF","children":[],"key":"k8PmSElqAv"}],"key":"wyKDwWZEP1"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Visualing the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MHMIYudcml"},{"type":"inlineMath","value":"R^2","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>R</mi><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">R^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span>","key":"nFWnmZ2a31"},{"type":"text","value":" results as a heatmap:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"papldLxQtt"}],"key":"byqfZP68B7"}],"key":"X8ISrObCyQ"}],"key":"rgr1akDyvO"}],"key":"IeRpQaXMdi"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.pyplot as plt\n\nplt.matshow(grid.cv_results_['mean_test_score'].reshape(3, -1),\n            vmin=0, cmap=\"viridis\")\nplt.xlabel(\"ridge__alpha\")\nplt.ylabel(\"polynomialfeatures__degree\")\nplt.xticks(range(len(param_grid['ridge__alpha'])), param_grid['ridge__alpha'])\nplt.yticks(range(len(param_grid['polynomialfeatures__degree'])),\n           param_grid['polynomialfeatures__degree'])\n\nplt.colorbar();","key":"YcyQnXeyMX"},{"type":"outputs","id":"vEHOUPlR2Wmq3gkjUgkp3","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"0438d4b13d638a92a9f823137e9b3ee5","path":"/0438d4b13d638a92a9f823137e9b3ee5.png"},"text/plain":{"content":"<Figure size 960x480 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"JFOdNpLak1"}],"key":"wyu6ClGeuU"}],"key":"XUNmh45rhh"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Another example (different dataset)\n\nfrom sklearn.pipeline import make_pipeline\nfrom sklearn.linear_model import Ridge\nfrom sklearn.model_selection import GridSearchCV\nfrom sklearn.datasets import fetch_openml\n\nboston = fetch_openml(name=\"boston\", as_frame=True)\nX_train, X_test, y_train, y_test = train_test_split(boston.data, boston.target,\n                                                    random_state=0)\nfrom sklearn.preprocessing import PolynomialFeatures\npipe = make_pipeline(StandardScaler(),PolynomialFeatures(),Ridge())\nparam_grid = {'polynomialfeatures__degree': [1, 2, 3],\n              'ridge__alpha': [0.001, 0.01, 0.1, 1, 10, 100]}\ngrid = GridSearchCV(pipe, param_grid=param_grid, cv=5)\ngrid.fit(X_train, y_train);\n\n#plot\nfig, ax = plt.subplots(figsize=(6, 3))\nim = ax.matshow(grid.cv_results_['mean_test_score'].reshape(3, -1),\n            vmin=0, cmap=\"viridis\")\nax.set_xlabel(\"ridge__alpha\")\nax.set_ylabel(\"polynomialfeatures__degree\")\nax.set_xticks(range(len(param_grid['ridge__alpha'])))\nax.set_xticklabels(param_grid['ridge__alpha'])\nax.set_yticks(range(len(param_grid['polynomialfeatures__degree'])))\nax.set_yticklabels(param_grid['polynomialfeatures__degree'])\nplt.colorbar(im);","key":"XcEwGXNECi"},{"type":"outputs","id":"QUhy9uDkrqLP_MAjZxKWz","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/Users/jvanscho/miniconda3/envs/mlcourse/lib/python3.10/site-packages/sklearn/datasets/_openml.py:323: UserWarning: Multiple active versions of the dataset matching the name boston exist. Versions may be fundamentally different, returning version 1. Available versions:\n- version 1, status: active\n  url: https://www.openml.org/search?type=data&id=531\n- version 2, status: active\n  url: https://www.openml.org/search?type=data&id=853\n\n  warn(warning_msg)\n"},"children":[],"key":"KecfaGVppc"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"aa00131f9aabd7b98dfa3e0c02561fe8","path":"/aa00131f9aabd7b98dfa3e0c02561fe8.png"},"text/plain":{"content":"<Figure size 600x300 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"Ei9Gv4yK8v"}],"key":"Z3G7DJpeBs"}],"key":"DU8zbPCPgz"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Here, degree-2 polynomials help (but degree-3 ones don’t), and tuning the alpha parameter helps as well.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DNBixRUuPN"}],"key":"gZm42Rpw8d"}],"key":"w0ORNZv4QO"},{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Not using the polynomial features leads to suboptimal results (see the results for degree 1)","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"JR8viIEq3V"}],"key":"la6EEcJ2RU"}],"key":"LX66Gcitu9"}],"key":"FnTBG58JJq"}],"key":"KdytPIVq13"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(\"Best parameters: {}\".format(grid.best_params_))\nprint(\"Test-set score: {:.2f}\".format(grid.score(X_test, y_test)))","key":"LtEJQWssoL"},{"type":"outputs","id":"QF4kg5pW7lnljYGA7JTad","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Best parameters: {'polynomialfeatures__degree': 2, 'ridge__alpha': 10}\nTest-set score: 0.77\n"},"children":[],"key":"hnXov6mZlT"}],"key":"W1td3IQSJ1"}],"key":"wxV1xLc7hg"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"FeatureUnions","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZxzpDonSGZ"}],"identifier":"featureunions","label":"FeatureUnions","html_id":"featureunions","implicit":true,"key":"zCVvoC9Uhv"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Sometimes you want to apply multiple preprocessing techniques and use the ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"vxniEFaNEA"},{"type":"emphasis","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"combined","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"pWpS07DFdD"}],"key":"vxQoQpI6D1"},{"type":"text","value":" produced features","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"wSoSF0Mpkv"}],"key":"m0okaSADRE"}],"key":"Nf00VfMALu"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Simply appending the produced features is called a ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"yjq5FMzuqr"},{"type":"inlineCode","value":"FeatureJoin","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"CkcHxNwMS6"}],"key":"WowcZqtzpb"}],"key":"AjAkCLPwua"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Example: Apply both PCA and feature selection, and run an SVM on both","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"AWeOEN9llL"}],"key":"FxT7kc0gPa"}],"key":"cQDcjGZ6Bj"}],"key":"MaRNVTnwUd"}],"key":"IrqGOWDUFF"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from sklearn.pipeline import Pipeline, FeatureUnion\nfrom sklearn.svm import SVC\nfrom sklearn.datasets import load_iris\nfrom sklearn.decomposition import PCA\nfrom sklearn.feature_selection import SelectKBest\n\niris = load_iris()\n\nX, y = iris.data, iris.target\n\n# This dataset is way too high-dimensional. Better do PCA:\npca = PCA(n_components=2)\n\n# Maybe some original features where good, too?\nselection = SelectKBest(k=1)\n\n# Build estimator from PCA and Univariate selection:\n\ncombined_features = FeatureUnion([(\"pca\", pca), (\"univ_select\", selection)])\n\n# Use combined features to transform dataset:\nX_features = combined_features.fit(X, y).transform(X)\nprint(\"Combined space has\", X_features.shape[1], \"features\")\n\nsvm = SVC(kernel=\"linear\")\n\n# Do grid search over k, n_components and C:\n\npipeline = Pipeline([(\"features\", combined_features), (\"svm\", svm)])\n\nparam_grid = dict(features__pca__n_components=[1, 2, 3],\n                  features__univ_select__k=[1, 2],\n                  svm__C=[0.1, 1, 10])\n\ngrid_search = GridSearchCV(pipeline, param_grid=param_grid)\ngrid_search.fit(X, y)\nprint(grid_search.best_estimator_)","key":"ihdYgqeq7b"},{"type":"outputs","id":"KFajpCABVXX1pRpV375si","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Combined space has 3 features\nPipeline(steps=[('features',\n                 FeatureUnion(transformer_list=[('pca', PCA(n_components=3)),\n                                                ('univ_select',\n                                                 SelectKBest(k=1))])),\n                ('svm', SVC(C=10, kernel='linear'))])\n"},"children":[],"key":"b6zmFBYrDd"}],"key":"MaBvsozrwb"}],"key":"PZ6C7j1uu5"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"ColumnTransformer","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Ejt7eFIuO7"}],"identifier":"columntransformer","label":"ColumnTransformer","html_id":"columntransformer","implicit":true,"key":"jTptZpZHXo"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"A pipeline applies a transformer on ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"nfE1PJdZ7L"},{"type":"emphasis","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"all","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"GyGQ62aaGe"}],"key":"ACvUW0LEZZ"},{"type":"text","value":" columns","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"BefYjTi0Ni"}],"key":"xdgCxNhljM"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"If your dataset has both numeric and categorical features, you often want to apply different techniques on each","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"cypVc7EDkS"}],"key":"owqAESoV5T"}],"key":"sSqH7hMOv3"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"You ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"WHWoMGzUjT"},{"type":"emphasis","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"could","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"tfmu9KiOeL"}],"key":"M4o7aswP7s"},{"type":"text","value":" manually split up the dataset, and then feature-join the processed features (tedious)","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"g0MCrYXJl9"}],"key":"WBoJEaI1hR"}],"key":"NJi7UjBIA7"}],"key":"MLWS1CFzDp"}],"key":"HWVBJadDbo"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"ColumnTransformer","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Xiw2BZ3WQG"},{"type":"text","value":" allows you to specify on which columns a preprocessor has to be run","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"CSQsKBWOS8"}],"key":"ZlaJt6syHZ"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Either by specifying the feature names, indices, or a binary mask","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"cfjijBvYQt"}],"key":"oT7qgU74HX"}],"key":"F3xtWVeo8Q"}],"key":"uhou76dc9S"}],"key":"RSIq03NJXi"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"You can include multiple transformers in a ColumnTransformer","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"BqPP9NZzSp"}],"key":"nro94j6PtP"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":8,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"In the end the results will be feature-joined","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"FQDmFUy0Tt"}],"key":"rIpiDCGnM5"}],"key":"hto4W0nI5J"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Hence, the order of the features will change!\nThe features of the last transformer will be at the end","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"LepNFpOxVF"}],"key":"zNKE1raXaR"}],"key":"TZTPYNUFTb"}],"key":"uTSZPCCDf6"}],"key":"aVc7ChP2VE"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Each transformer can be a pipeline","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"FdwfT6SOTi"}],"key":"IfZCt1baLp"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":12,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Handy if you need to apply multiple preprocessing steps on a set of features","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"bMLfy8G2oC"}],"key":"FrXu3qPWnl"}],"key":"px1hWMTOuH"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"E.g. use a ColumnTransformer with one sub-pipeline for numerical features and one for categorical features.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"IHB4uugbDH"}],"key":"j4pYQ26Vnn"}],"key":"HDIfz27ZvZ"}],"key":"dR7vblxtOV"}],"key":"luh08NFQJt"},{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"In the end, the columntransformer can again be included as part of a pipeline","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"umPfIpKefO"}],"key":"foc4GWudYA"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"E.g. to add a classfier and include the whole pipeline in a grid search","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"cUnVo8MAU7"}],"key":"BWRKOklRQx"}],"key":"PFxkrgqp7N"}],"key":"c1DNAM5Bhu"}],"key":"ssopQg6oK7"}],"key":"dJ33B4RAgF"}],"key":"S9GKHdyiFX"},{"type":"block","kind":"notebook-content","children":[{"type":"code","lang":"python","value":"# 2 sub-pipelines, one for numeric features, other for categorical ones\nnumeric_pipe = make_pipeline(SimpleImputer(),StandardScaler())\ncategorical_pipe = make_pipeline(SimpleImputer(),OneHotEncoder())\n\n# Using categorical pipe for features A,B,C, numeric pipe otherwise\npreprocessor = make_column_transformer((categorical_pipe,\n                                        [\"A\",\"B\",\"C\"]), \n                                        remainder=numeric_pipe)\n\n# Combine with learning algorithm in another pipeline\n\n``` python\npipe = make_pipeline(preprocessor, LinearSVC())","position":{"start":{"line":1,"column":1},"end":{"line":15,"column":1}},"key":"QDqIostETW"}],"key":"F7lBjEhmzw"},{"type":"block","kind":"notebook-content","children":[{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Careful: ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lY2i42rdmb"},{"type":"inlineCode","value":"ColumnTransformer","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vTQPYUGOuh"},{"type":"text","value":" concatenates features in order","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gPe0KN6vtS"}],"key":"v6ppFrd1Cc"}],"key":"ydF7s9e6cW"}],"key":"pqf4fEXxSU"},{"type":"code","lang":"python","value":"pipe = make_column_transformer((StandardScaler(),numeric_features), \n                               (PCA(),numeric_features),\n                               (OneHotEncoder(),categorical_features))","position":{"start":{"line":3,"column":1},"end":{"line":7,"column":1}},"key":"dRJDRTi9Qi"},{"type":"image","style":{"width":"900px"},"url":"/d54fe761f64f3976f3ccbb0bc517865f.png","alt":"ml","key":"nRDlKOzIRv","urlSource":"https://raw.githubusercontent.com/ML-course/master/master/notebooks/images/columntransformer.png","urlOptimized":"/d54fe761f64f3976f3ccbb0bc517865f.webp"}],"key":"ghYUxqlMMV"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Example: Handle a dataset (Titanic) with both categorical an numeric features","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zc3hJ03q7Y"}],"key":"dVOk7aFqVF"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Numeric features: impute missing values and scale","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"TZu9ccjjvZ"}],"key":"W0m1u9XZnI"}],"key":"JHullTpGEQ"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Categorical features: Impute missing values and apply one-hot-encoding","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"sO8U1p0kR9"}],"key":"POC6NBKHoN"}],"key":"v8K33m0oZq"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Finally, run an SVM","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"A82CFrSEFo"}],"key":"Ed7yJEHkkx"}],"key":"PROA4eWmqZ"}],"key":"amI6kBXs9A"}],"key":"VOXhp7SGyY"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from sklearn.compose import ColumnTransformer\nfrom sklearn.datasets import fetch_openml\nfrom sklearn.impute import SimpleImputer\nfrom sklearn.preprocessing import StandardScaler, OneHotEncoder\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.model_selection import train_test_split, GridSearchCV\n\nnp.random.seed(0)\n\n# Load data from https://www.openml.org/d/40945\nX, y = fetch_openml(\"titanic\", version=1, as_frame=True, return_X_y=True)\n\n# Alternatively X and y can be obtained directly from the frame attribute:\n# X = titanic.frame.drop('survived', axis=1)\n# y = titanic.frame['survived']\n\n# We will train our classifier with the following features:\n# Numeric Features:\n# - age: float.\n# - fare: float.\n# Categorical Features:\n# - embarked: categories encoded as strings {'C', 'S', 'Q'}.\n# - sex: categories encoded as strings {'female', 'male'}.\n# - pclass: ordinal integers {1, 2, 3}.\n\n# We create the preprocessing pipelines for both numeric and categorical data.\nnumeric_features = ['age', 'fare']\nnumeric_transformer = Pipeline(steps=[\n    ('imputer', SimpleImputer(strategy='median')),\n    ('scaler', StandardScaler())])\n\ncategorical_features = ['embarked', 'sex', 'pclass']\ncategorical_transformer = Pipeline(steps=[\n    ('imputer', SimpleImputer(strategy='constant', fill_value='missing')),\n    ('onehot', OneHotEncoder(handle_unknown='ignore'))])\n\npreprocessor = ColumnTransformer(\n    transformers=[\n        ('num', numeric_transformer, numeric_features),\n        ('cat', categorical_transformer, categorical_features)])\n\n# Append classifier to preprocessing pipeline.\n# Now we have a full prediction pipeline.\nclf = Pipeline(steps=[('preprocessor', preprocessor),\n                      ('classifier', LogisticRegression())])\n\nX_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2)\n\nclf.fit(X_train, y_train)\nprint(\"model score: %.3f\" % clf.score(X_test, y_test))","key":"rrcCtt4BTf"},{"type":"outputs","id":"_4ioREyl6lZYlG71TxpxZ","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"model score: 0.790\n"},"children":[],"key":"k7sXL8zjkQ"}],"key":"ULiB3Q724Q"}],"key":"p0aHdY6bJG"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"You can again run optimize any of the hyperparameters (preprocessing-related ones included) in a grid search","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DwAinYv2zM"}],"key":"UjXTady3or"}],"key":"ZErh58IuLf"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"param_grid = {\n    'preprocessor__num__imputer__strategy': ['mean', 'median'],\n    'classifier__C': [0.1, 1.0, 10, 100],\n}\n\ngrid_search = GridSearchCV(clf, param_grid, cv=10)\ngrid_search.fit(X_train, y_train)\n\nprint((\"best logistic regression from grid search: %.3f\"\n       % grid_search.score(X_test, y_test)))","key":"ZwpmONaEAI"},{"type":"outputs","id":"svJl_Oktw1E8vioSHGmUU","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"best logistic regression from grid search: 0.798\n"},"children":[],"key":"Oo4hIiC3Kj"}],"key":"ZC0VFcmbQl"}],"key":"NP8ZFhLg9G"}],"key":"cUEOK5kknB"},"references":{"cite":{"order":[],"data":{}}}}