{"version":3,"kind":"Notebook","sha256":"875ec9cdb4116c5f8e20cb89f5cc31aaee12a7ec0e7a92343a7519528b33ea11","slug":"labs.lab-4-neural-networks","location":"/labs/Lab 4 - Neural Networks.ipynb","dependencies":[],"frontmatter":{"title":"Lab 4: Neural networks","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"github":"https://github.com/ml-course/master","copyright":"2025. CC0 Licensed - Use as you like. Appropriate credit is very welcome","numbering":{"title":{"offset":1}},"source_url":"https://github.com/ml-course/master/blob/master/labs/Lab 4 - Neural Networks.ipynb","edit_url":"https://github.com/ml-course/master/edit/master/labs/Lab 4 - Neural Networks.ipynb","exports":[{"format":"ipynb","filename":"Lab 4 - Neural Networks.ipynb","url":"/Lab 4 - Neural Netwo-2866e7fb7651248f2b26888f01be53b4.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{"id":"TL5y5fY9Jy_x"},"children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In this lab we will build dense neural networks on the MNIST dataset.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"AOeQq3nmch"}],"key":"Kc5t84Jzb7"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Make sure you read the tutorial for this lab first.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"LUxYRKK2zU"}],"key":"X2A5qEEGno"}],"identifier":"tl5y5fy9jy_x","label":"TL5y5fY9Jy_x","html_id":"tl5y5fy9jy-x","key":"iBtR7fHMMc"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Load the data and create train-test splits","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"A3lgp19Lyg"}],"identifier":"load-the-data-and-create-train-test-splits","label":"Load the data and create train-test splits","html_id":"load-the-data-and-create-train-test-splits","implicit":true,"key":"YqVT0fkJRT"}],"key":"miG5gcu5aa"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Auto-setup when running on Google Colab\nif 'google.colab' in str(get_ipython()):\n    !pip install openml\n\n# General imports\n%matplotlib inline\nimport numpy as np\nimport pandas as pd\nimport openml as oml\nimport matplotlib.pyplot as plt\nimport pytorch_lightning as pl\nimport torch\nimport torch.nn.functional as F\nfrom torch import nn\nfrom torch.utils.data import DataLoader, random_split\nfrom torchvision import datasets, transforms","key":"VVdItQk9Nz"},{"type":"outputs","id":"4q5uQyjeZY4rucBSIP-FA","children":[],"key":"SOlGV1zPlk"}],"key":"YQJtsMckzf"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Download MNIST data. Takes a while the first time.\nmnist = oml.datasets.get_dataset(554)\nX, y, _, _ = mnist.get_data(target=mnist.default_target_attribute, dataset_format='array');\nX = X.reshape(70000, 28, 28)\n\n# Take some random examples\nfrom random import randint\nfig, axes = plt.subplots(1, 5,  figsize=(10, 5))\nfor i in range(5):\n    n = randint(0,70000)\n    axes[i].imshow(X[n], cmap=plt.cm.gray_r)\n    axes[i].set_xticks([])\n    axes[i].set_yticks([])\n    axes[i].set_xlabel(\"{}\".format(y[n]))\nplt.show();","key":"PFKxDR0Yt1"},{"type":"outputs","id":"XIMRlVgyQ6YeOyUXfSXg5","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"661826c29f54e3ba2de4dacf3c5932b8","path":"/661826c29f54e3ba2de4dacf3c5932b8.png"},"text/plain":{"content":"<Figure size 720x360 with 5 Axes>","content_type":"text/plain"}}},"children":[],"key":"saYqLAI0CD"}],"key":"LPDOWKpNDP"}],"key":"DPteHKv8fT"},{"type":"block","kind":"notebook-code","data":{"id":"JZlvdpyYKx7V"},"children":[{"type":"code","lang":"python","executable":true,"value":"# For MNIST, there exists a predefined stratified train-test split of 60000-10000. We therefore don't shuffle or stratify here.\nfrom sklearn.model_selection import train_test_split\nX_train, X_test, y_train, y_test = train_test_split(X, y, train_size=60000, random_state=0)","identifier":"jzlvdpyykx7v-code","enumerator":"1","html_id":"jzlvdpyykx7v-code","key":"Xxd8O0jFKa"},{"type":"outputs","id":"mKhWRHPgi92kCF2F6LQxS","children":[],"identifier":"jzlvdpyykx7v-outputs","html_id":"jzlvdpyykx7v-outputs","key":"kR5ofQQ1eX"}],"identifier":"jzlvdpyykx7v","label":"JZlvdpyYKx7V","html_id":"jzlvdpyykx7v","key":"ZEFCZJTNVn"},{"type":"block","kind":"notebook-content","data":{"id":"8ldP-5z1B2vL"},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Exercise 1: Preprocessing","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ePJFWDu0ix"}],"identifier":"exercise-1-preprocessing","label":"Exercise 1: Preprocessing","html_id":"exercise-1-preprocessing","implicit":true,"key":"Ohq5cKOKDr"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Normalize the data: map each feature value from its current representation (an integer between 0 and 255) to a floating-point value between 0 and 1.0.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"MuF0UedqN7"}],"key":"QZkc9dhU8q"}],"key":"Qbm3d767gY"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Create a train-test split using the first 60000 examples for training","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"WPjHYY8s7H"}],"key":"oRID1cskkm"}],"key":"ovlEkb3uG5"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Flatten the data","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"y0HOotiydz"}],"key":"IIRlBggWPi"}],"key":"yD1TN6Xyds"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Convert the data (numpy arrays) to PyTorch tensors","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"xaoQfRr4yV"}],"key":"oaGUfpsRym"}],"key":"pwqCWKmLYK"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Create a TensorDataset for the training data, and another for the testing data","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"FGWTNsY4vS"}],"key":"dfqzlwilOK"}],"key":"f0AB19Jvrk"}],"key":"ydZIpzBQeP"}],"identifier":"8ldp-5z1b2vl","label":"8ldP-5z1B2vL","html_id":"id-8ldp-5z1b2vl","key":"kIUo6jkpqg"},{"type":"block","kind":"notebook-content","data":{"id":"3014ezH3C7jT"},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Exercise 2: Create a deep neural net model","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"eNJNakJdet"}],"identifier":"exercise-2-create-a-deep-neural-net-model","label":"Exercise 2: Create a deep neural net model","html_id":"exercise-2-create-a-deep-neural-net-model","implicit":true,"key":"dOVPoLwaUo"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Implement a ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gPiBvRXI63"},{"type":"inlineCode","value":"create_model","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"QDRcgxobBq"},{"type":"text","value":" function which defines the topography of the deep neural net, specifying the following:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"RIaeb3wsbd"}],"key":"wE38iIBEaB"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The number of layers in the deep neural net: Use 2 dense layers for now (one hidden en one output layer)","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"SKoFZMJpz8"}],"key":"wNwyIQxsMK"}],"key":"NZKGO1bX2o"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The number of nodes in each layer: these are parameters of your function.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"eViJclzWfo"}],"key":"MTDt7R7lhV"}],"key":"hTxTj0N96t"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Any regularization layers. Add at least one dropout layer.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"PZV4whR9TB"}],"key":"lyMQqmAXeN"}],"key":"o5RxCeUAwk"}],"key":"sAYiD2td0M"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Consider:","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"KhW9QdOlpB"}],"key":"x0tl8SUrql"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":10,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"What should be the shape of the input layer?","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"r3WjEXMBXr"}],"key":"ifEjlyiOdD"}],"key":"VnT14coZMB"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Which activation function you will need for the last layer, since this is a 10-class classification problem?","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"lfyMkvBF0G"}],"key":"DrryWuGJny"}],"key":"QZmBi63iQw"}],"key":"T9LMcHd6R8"}],"identifier":"3014ezh3c7jt","label":"3014ezH3C7jT","html_id":"id-3014ezh3c7jt","key":"XYysK2ZeA7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"### Create and compile a 'deep' neural net\ndef create_model(layer_1_units=32, layer_2_units=10, dropout_rate=0.3):\n    pass","key":"wOnzV8x4Ua"},{"type":"outputs","id":"vRbIFUci6bDLnHmzQ_oqk","children":[],"key":"vPyRMx24H9"}],"key":"yCAr8b7y56"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Exercise 3: Create a training function","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lCmchoq9oV"}],"identifier":"exercise-3-create-a-training-function","label":"Exercise 3: Create a training function","html_id":"exercise-3-create-a-training-function","implicit":true,"key":"RjnT0XyZQB"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Implement a ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"hrhNON6iZG"},{"type":"inlineCode","value":"train_model","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"G3fBjokAmH"},{"type":"text","value":" function which trains and evaluates a given model.\nIt should print out the train and validation loss and accuracy.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"fdGwyfKZvX"}],"key":"C4PRBT2w8s"}],"key":"PLRymd8LOt"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"def train_model(model, train_dataset, val_dataset, epochs=10, batch_size=64, learning_rate=0.001):\n    \"\"\"\n    model: the model to train\n    train_dataset: the training data and labels\n    test_dataset: the test data and labels\n    epochs: the number of epochs to train for\n    batch_size: the batch size for minibatch SGD\n    learning_rate: the learning rate for the optimizer\n    \"\"\"\n    pass","key":"qrg4lFnyMO"},{"type":"outputs","id":"ZsD7BbcdsOKzZ7ObnFmnR","children":[],"key":"M7Crgvrtwv"}],"key":"SEwFTdEUgu"},{"type":"block","kind":"notebook-content","data":{"id":"D-IXYVfvM4gD"},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Exercise 4: Evaluate the model","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cMNi0wHOBs"}],"identifier":"exercise-4-evaluate-the-model","label":"Exercise 4: Evaluate the model","html_id":"exercise-4-evaluate-the-model","implicit":true,"key":"EvtroZnUy7"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Train the model with a learning rate of 0.003, 50 epochs, batch size 4000, and a validation set that is 20% of the total training data.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NwT6RggWE2"}],"key":"foIzhv4ONk"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Use default settings otherwise. Plot the learning curve of the loss, validation loss, accuracy, and validation accuracy. Finally, report the performance on the test set.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"vJXttuem53"}],"key":"CKcs6Drz6M"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Try to run the model on GPU.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"fZHZym9bhW"}],"key":"nCzlYZDW8W"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Feel free to use the plotting function below, or implement the callback from the tutorial to see results in real time.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"yAxLnLPiEq"}],"key":"wvOVEME23X"}],"identifier":"d-ixyvfvm4gd","label":"D-IXYVfvM4gD","html_id":"d-ixyvfvm4gd","key":"wPQu67EH5x"},{"type":"block","kind":"notebook-code","data":{"cellView":"form","id":"QF0BFRXTOeR3"},"children":[{"type":"code","lang":"python","executable":true,"value":"# Helper plotting function\n#\n# history: the history object returned by the training function\n\ndef plot_curve(history):\n    \"\"\"\n    Plots the learning curves for accuracy and loss.\n\n    history: Dictionary containing 'accuracy', 'val_accuracy', 'loss', 'val_loss' per epoch.\n    \"\"\"\n    epochs = range(1, len(history[\"accuracy\"]) + 1)\n\n    plt.figure(figsize=(12, 5))\n\n    # Accuracy Plot\n    plt.subplot(1, 2, 1)\n    plt.plot(epochs, history[\"accuracy\"], label=\"Train Accuracy\")\n    plt.plot(epochs, history[\"val_accuracy\"], label=\"Validation Accuracy\")\n    plt.xlabel(\"Epochs\")\n    plt.ylabel(\"Accuracy\")\n    plt.title(\"Accuracy Curve\")\n    plt.legend()\n\n    # Loss Plot\n    plt.subplot(1, 2, 2)\n    plt.plot(epochs, history[\"loss\"], label=\"Train Loss\")\n    plt.plot(epochs, history[\"val_loss\"], label=\"Validation Loss\")\n    plt.xlabel(\"Epochs\")\n    plt.ylabel(\"Loss\")\n    plt.title(\"Loss Curve\")\n    plt.legend()\n\n    plt.show()","identifier":"qf0bfrxtoer3-code","enumerator":"2","html_id":"qf0bfrxtoer3-code","key":"lunbtSU7Yu"},{"type":"outputs","id":"Ytr0ItTI20hoPq85yDYI2","children":[],"identifier":"qf0bfrxtoer3-outputs","html_id":"qf0bfrxtoer3-outputs","key":"ydMTV9fvLn"}],"identifier":"qf0bfrxtoer3","label":"QF0BFRXTOeR3","html_id":"qf0bfrxtoer3","key":"zW2qpe5v1Q"},{"type":"block","kind":"notebook-content","data":{"id":"Y5IKmk7D49_n"},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Exercise 5: Optimize the model","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HIxc34yY98"}],"identifier":"exercise-5-optimize-the-model","label":"Exercise 5: Optimize the model","html_id":"exercise-5-optimize-the-model","implicit":true,"key":"gdxUQk3nNY"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Try to optimize the model, either manually or with a tuning method. At least optimize the following:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"W0bT0HvATW"}],"key":"ZjVGyECG15"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"the number of hidden layers","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"AyPd1OJ9Eg"}],"key":"fVRtsuyogh"}],"key":"Pu4UyV6Wkn"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"the number of nodes in each layer","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"JsgbSugb7a"}],"key":"OrnKboZfAI"}],"key":"den5GSMxPP"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"the amount of dropout layers and the dropout rate","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"l8j8tMLTdj"}],"key":"ZrlpGjRwvF"}],"key":"sgriQs68Sd"}],"key":"jck27oyzIv"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Try to reach at least 96% accuracy against the test set.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"JspU5fF689"}],"key":"NVosWWKpv4"}],"identifier":"y5ikmk7d49_n","label":"Y5IKmk7D49_n","html_id":"y5ikmk7d49-n","key":"Iv3aRNJoIJ"}],"key":"DqOjV0dwuL"},"references":{"cite":{"order":[],"data":{}}}}