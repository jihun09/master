{"version":3,"kind":"Notebook","sha256":"600b48c66a1005d077a3c3d789cca491f5b4fcd1fad594958baceb9b5b3ad192","slug":"labs.lab-2-tutorial","location":"/labs/Lab 2 - Tutorial.ipynb","dependencies":[],"frontmatter":{"title":"Lab 2: Model Selection in scikit-learn","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"github":"https://github.com/ml-course/master","copyright":"2025. CC0 Licensed - Use as you like. Appropriate credit is very welcome","numbering":{"title":{"offset":1}},"source_url":"https://github.com/ml-course/master/blob/master/labs/Lab 2 - Tutorial.ipynb","edit_url":"https://github.com/ml-course/master/edit/master/labs/Lab 2 - Tutorial.ipynb","thumbnail":"/4829f5b2dbbf245223508638b687a2c0.png","thumbnailOptimized":"/4829f5b2dbbf245223508638b687a2c0.webp","exports":[{"format":"ipynb","filename":"Lab 2 - Tutorial.ipynb","url":"/Lab 2 - Tutorial-ccfd8ee6c55df5975d437e1de97ecb82.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","data":{"hide_input":false,"slideshow":{"slide_type":"skip"}},"children":[{"type":"code","lang":"python","executable":true,"value":"# General imports\n%matplotlib inline\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport openml as oml\nfrom matplotlib import cm\n\n# We can ignore ConvergenceWarnings for illustration purposes\nimport warnings\nwarnings.simplefilter(action=\"ignore\", category=UserWarning)","key":"M0DSHV5lFr"},{"type":"outputs","id":"sHwnc063--2t80cmJOqmc","children":[],"key":"lXncA7g6mX"}],"key":"XoInUmtbFg"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Evaluation procedures","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AFTgUU2OPP"}],"identifier":"evaluation-procedures","label":"Evaluation procedures","html_id":"evaluation-procedures","implicit":true,"key":"YpV3CVtAbp"},{"type":"heading","depth":3,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Holdout","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"i1kNqOs523"}],"identifier":"holdout","label":"Holdout","html_id":"holdout","implicit":true,"key":"kWT8ajYPfQ"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The simplest procedure is ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Ev6JKYeBG2"},{"type":"link","url":"https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.train_test_split.html","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"train_test_split","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"QrpwGwGdOP"}],"urlSource":"https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.train_test_split.html","key":"hhW1fl3XJh"},{"type":"text","value":", which splits arrays or matrices into random train and test subsets.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"SlYfI6kuRV"}],"key":"m6fyAVxDvH"}],"key":"roOta2vsWy"},{"type":"block","kind":"notebook-code","data":{"hide_input":true,"slideshow":{"slide_type":"-"}},"children":[{"type":"code","lang":"python","executable":true,"value":"from sklearn.datasets import make_blobs\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.model_selection import train_test_split\n\n# create a synthetic dataset\nX, y = make_blobs(centers=2, random_state=0)\n# split data and labels into a training and a test set\nX_train, X_test, y_train, y_test = train_test_split(X, y, random_state=0)\n# Instantiate a model and fit it to the training set\nmodel = LogisticRegression().fit(X_train, y_train)\n# evaluate the model on the test set\nprint(\"Test set score: {:.2f}\".format(model.score(X_test, y_test)))","key":"punOmd69qb"},{"type":"outputs","id":"qT23ZmkfVwloIqp-rwpxR","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Test set score: 0.92\n"},"children":[],"key":"iXq5MBiD3G"}],"key":"VI1QrexQ53"}],"key":"ko11UHqNm3"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Cross-validation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bzpskbPC3W"}],"identifier":"cross-validation","label":"Cross-validation","html_id":"cross-validation","implicit":true,"key":"loyi72M5SA"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"link","url":"https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.cross_val_score.html?highlight=cross%20val%20score#sklearn.model_selection.cross_val_score","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"cross_val_score","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Av1AxEnERn"}],"urlSource":"https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.cross_val_score.html?highlight=cross%20val%20score#sklearn.model_selection.cross_val_score","key":"E6YazWkPfi"}],"key":"WGs4OAQ686"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"cv","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"HHizVCPwQP"},{"type":"text","value":" parameter defines the kind of cross-validation splits, default is 5-fold CV","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Ozw7OeE06u"}],"key":"VUkXs3p0fj"}],"key":"pEPbbHQc73"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"scoring","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"MfBVzVOyJG"},{"type":"text","value":" defines the scoring metric. Also see below.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"H21y3sezIg"}],"key":"UounDrLgVa"}],"key":"fDTXOZPeEE"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Returns list of all scores. Models are built internally, but not returned","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"xk0PiRDCAe"}],"key":"JdSIjDNfgd"}],"key":"o0V0Swol8a"}],"key":"vr8WLhJN1e"}],"key":"Pnbl4Qhnds"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"link","url":"https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.cross_validate.html?highlight=cross%20validate#sklearn.model_selection.cross_validate","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"cross_validate","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"HR2edzGQlO"}],"urlSource":"https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.cross_validate.html?highlight=cross%20validate#sklearn.model_selection.cross_validate","key":"XQ1MEtF0Iv"}],"key":"y1fcnWOjmM"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Similar, but also returns the fit and test times, and allows multiple scoring metrics.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"mcGTLIFSSI"}],"key":"PBlIE0Eb9y"}],"key":"e81r6El4iK"}],"key":"MN8E5APWcU"}],"key":"z8eCgHjosl"}],"key":"hrNwsCjJWf"}],"key":"d5uGVVOk7R"},{"type":"block","kind":"notebook-code","data":{"hide_input":true},"children":[{"type":"code","lang":"python","executable":true,"value":"from sklearn.model_selection import cross_val_score\nfrom sklearn.datasets import load_iris\nfrom sklearn.linear_model import LogisticRegression\n\niris = load_iris()\nlogreg = LogisticRegression()\n\nscores = cross_val_score(logreg, iris.data, iris.target, cv=5)\nprint(\"Cross-validation scores: {}\".format(scores))\nprint(\"Average cross-validation score: {:.2f}\".format(scores.mean()))\nprint(\"Variance in cross-validation score: {:.4f}\".format(np.var(scores)))","key":"iPBmlbdBKl"},{"type":"outputs","id":"6qj0ugjxpgjH2DMsb0ENe","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Cross-validation scores: [0.96666667 1.         0.93333333 0.96666667 1.        ]\nAverage cross-validation score: 0.97\nVariance in cross-validation score: 0.0006\n"},"children":[],"key":"Tt0M9tNZzA"}],"key":"j9Jcc8JUy1"}],"key":"FEY58T1tQX"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Custom CV splits","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YtrHsN4tOd"}],"identifier":"custom-cv-splits","label":"Custom CV splits","html_id":"custom-cv-splits","implicit":true,"key":"YlSgmP3BKG"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"You can build folds manually with ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"fvgF7SmreR"},{"type":"link","url":"https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.KFold.html?highlight=kfold#sklearn.model_selection.KFold","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"KFold","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"mDpSfG40lf"}],"urlSource":"https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.KFold.html?highlight=kfold#sklearn.model_selection.KFold","key":"S8qk5JYVd4"},{"type":"text","value":" or ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"CNPjnQExKn"},{"type":"link","url":"https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.StratifiedKFold.html#sklearn.model_selection.StratifiedKFold","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"StratifiedKFold","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"g422VoRWtD"}],"urlSource":"https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.StratifiedKFold.html#sklearn.model_selection.StratifiedKFold","key":"OgUSnUXeec"}],"key":"brNEFDKTJ6"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"randomizable (","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"DzugJd1Gi1"},{"type":"inlineCode","value":"shuffle","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"DDmYOJOAF2"},{"type":"text","value":" parameter)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"tFKR1Jxure"}],"key":"QLtTkvqjF0"}],"key":"XhsRqKVzRF"}],"key":"SBvsVBRsfn"}],"key":"TMhhQQFKbF"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"link","url":"https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.LeaveOneOut.html?highlight=leave%20one%20out#sklearn.model_selection.LeaveOneOut","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"LeaveOneOut","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"t91Spano79"}],"urlSource":"https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.LeaveOneOut.html?highlight=leave%20one%20out#sklearn.model_selection.LeaveOneOut","key":"u46KGCbK5J"},{"type":"text","value":" does leave-one-out cross-validation","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Xqp0eQzFy8"}],"key":"xdFdltFPYV"}],"key":"IZxLoYkQKU"}],"key":"qanaNCIVAb"}],"key":"yYRwu9Q685"},{"type":"block","kind":"notebook-code","data":{"hide_input":true},"children":[{"type":"code","lang":"python","executable":true,"value":"from sklearn.model_selection import KFold, StratifiedKFold\nkfold = KFold(n_splits=5)\nprint(\"Cross-validation scores KFold(n_splits=5):\\n{}\".format(\n      cross_val_score(logreg, iris.data, iris.target, cv=kfold)))\nskfold = StratifiedKFold(n_splits=5, shuffle=True)\nprint(\"Cross-validation scores StratifiedKFold(n_splits=5, shuffle=True):\\n{}\".format(\n      cross_val_score(logreg, iris.data, iris.target, cv=skfold)))","key":"o14s1MnXVY"},{"type":"outputs","id":"08Nv7cagnWVgnuGasla3s","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Cross-validation scores KFold(n_splits=5):\n[1.         1.         0.86666667 0.93333333 0.83333333]\nCross-validation scores StratifiedKFold(n_splits=5, shuffle=True):\n[0.93333333 0.93333333 1.         0.96666667 0.96666667]\n"},"children":[],"key":"Puk0mUeRoa"}],"key":"V8tFVWa6pL"}],"key":"w8FrwiMfLX"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from sklearn.model_selection import LeaveOneOut\nloo = LeaveOneOut()\nscores = cross_val_score(logreg, iris.data, iris.target, cv=loo)\nprint(\"Number of cv iterations: \", len(scores))\nprint(\"Mean accuracy: {:.2f}\".format(scores.mean()))","key":"MTzWvkMPed"},{"type":"outputs","id":"8zqNW9rBl9Me11UQz_2vc","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Number of cv iterations:  150\nMean accuracy: 0.97\n"},"children":[],"key":"MD0OARkgwe"}],"key":"lx5cGkdy4P"}],"key":"TDgweuRouG"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Shuffle-split","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LiigknW1Jn"}],"identifier":"shuffle-split","label":"Shuffle-split","html_id":"shuffle-split","implicit":true,"key":"yBUFJJBmg7"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"These shuffle the data before splitting it.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"GSo4L9ZPoS"}],"key":"Wnv38ZQVhX"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"ShuffleSplit","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"TEFHvyHXrr"},{"type":"text","value":" and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"sxzB6MRWc9"},{"type":"inlineCode","value":"StratifiedShuffleSplit","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"uFeBsrU99P"},{"type":"text","value":" (recommended for classification)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"MtYZ1NyMtC"}],"key":"tqo5ccOMmB"}],"key":"Huo3xujxWV"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"train_size","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"uENSCGlaDT"},{"type":"text","value":" and ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"P085VhsqPi"},{"type":"inlineCode","value":"test_size","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Uuu5MOCo7m"},{"type":"text","value":" can be absolute numbers or a percentage of the total dataset","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"M2l3pANRgV"}],"key":"M2GXMcH7aJ"}],"key":"L945egkMcD"}],"key":"AlrQGEsqNM"}],"key":"WmFgNRybk5"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from sklearn.model_selection import ShuffleSplit, StratifiedShuffleSplit\nshuffle_split = StratifiedShuffleSplit(test_size=.5, train_size=.5, n_splits=10)\nscores = cross_val_score(logreg, iris.data, iris.target, cv=shuffle_split)\nprint(\"Cross-validation scores:\\n{}\".format(scores))","key":"IajnAbN1ii"},{"type":"outputs","id":"8eaaJVI7yY-mtf-_mwLnM","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Cross-validation scores:\n[0.93333333 0.98666667 0.97333333 0.94666667 0.90666667 0.94666667\n 0.98666667 0.96       0.96       0.96      ]\n"},"children":[],"key":"FwxjmMKxbo"}],"key":"AHCOt2DSuk"}],"key":"sXwykUiYU7"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Grouped cross-validation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Od2BWu84iz"}],"identifier":"grouped-cross-validation","label":"Grouped cross-validation","html_id":"grouped-cross-validation","implicit":true,"key":"YOjJA843aG"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Add an array with group membership to ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"idlzlJ4304"},{"type":"inlineCode","value":"cross_val_scores","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"NwSjfqBLIK"}],"key":"wQ0adyBXXV"}],"key":"VTT2oqdOC1"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Use ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"oNDiOYBIQW"},{"type":"inlineCode","value":"GroupKFold","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"QOHSMteNTg"},{"type":"text","value":" with the number of groups as CV procedure","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vn1Hd16Akf"}],"key":"eC6jVg22NB"}],"key":"kSCo4ojanj"}],"key":"Y6HzDbgO0x"}],"key":"uBt0Tcz5Kt"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from sklearn.model_selection import GroupKFold\n# create synthetic dataset\nX, y = make_blobs(n_samples=12, random_state=0)\n# the first three samples belong to the same group, etc.\ngroups = [0, 0, 0, 1, 1, 1, 2, 2, 2, 3, 3, 3]\nscores = cross_val_score(logreg, X, y, groups=groups, cv=GroupKFold(n_splits=4))\nprint(\"Cross-validation scores :\\n{}\".format(scores))","key":"pCStqYg9Iu"},{"type":"outputs","id":"v8vfxMvgL-mqyQ6c42ICg","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Cross-validation scores :\n[0.66666667 0.66666667 1.         0.66666667]\n"},"children":[],"key":"xf9Y0mgKRE"}],"key":"W8dzhesVYd"}],"key":"pnOTdXbfT0"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Evaluation Metrics","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Oe0crx6gVA"}],"identifier":"evaluation-metrics","label":"Evaluation Metrics","html_id":"evaluation-metrics","implicit":true,"key":"oPU1uihQBQ"}],"key":"zJkwd1xcRE"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Binary classification","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AiXJwec55P"}],"identifier":"binary-classification","label":"Binary classification","html_id":"binary-classification","implicit":true,"key":"WDcOiUDUTL"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"link","url":"https://scikit-learn.org/stable/modules/generated/sklearn.metrics.confusion_matrix.html?highlight=confusion%20matrix#sklearn.metrics.confusion_matrix","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"confusion_matrix","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"pu7Jo09mTm"}],"urlSource":"https://scikit-learn.org/stable/modules/generated/sklearn.metrics.confusion_matrix.html?highlight=confusion%20matrix#sklearn.metrics.confusion_matrix","key":"WI8TdLuIxH"},{"type":"text","value":" returns a matrix counting how many test examples are predicted correctly or ‘confused’ with other metrics.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"rJk7ei4yUX"}],"key":"pZnPXGYpjJ"}],"key":"TIB8Z6F1vX"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"link","url":"https://scikit-learn.org/stable/modules/classes.html?highlight=metrics#module-sklearn.metrics","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"sklearn.metrics","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"m6V42CCnmC"}],"urlSource":"https://scikit-learn.org/stable/modules/classes.html?highlight=metrics#module-sklearn.metrics","key":"EO486FdHWB"},{"type":"text","value":" contains implementations many of the metrics discussed in class","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"UxMAZnbNPu"}],"key":"hkPXReHoNA"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"They are all implemented so that ‘higher is better’.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"bqU7iFWbLw"}],"key":"PcwK74lWNW"}],"key":"cDBBxnB0A8"}],"key":"ZNSa96rPEZ"}],"key":"Da34EFrEq1"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"link","url":"https://scikit-learn.org/stable/modules/generated/sklearn.metrics.accuracy_score.html#sklearn.metrics.accuracy_score","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"accuracy_score","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"kwaSCj4pMs"}],"urlSource":"https://scikit-learn.org/stable/modules/generated/sklearn.metrics.accuracy_score.html#sklearn.metrics.accuracy_score","key":"TnjFfhiENW"},{"type":"text","value":" computes accuracy explictly","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"MuYHigAorb"}],"key":"GDTCIKxyH9"}],"key":"I7uNWLShki"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"link","url":"https://scikit-learn.org/stable/modules/generated/sklearn.metrics.classification_report.html","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"classification​_report","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"j6cqn8hL24"}],"urlSource":"https://scikit-learn.org/stable/modules/generated/sklearn.metrics.classification_report.html","key":"kp27441RUH"},{"type":"text","value":" returns a table of binary measures, per class, and aggregated according to different aggregation functions.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"tp3UNkk8on"}],"key":"PFZOb1RNkX"}],"key":"Ch7yN3ikoW"}],"key":"ss1bvi9bpU"}],"key":"AFtxzDGZpk"},{"type":"block","kind":"notebook-code","data":{"hide_input":false},"children":[{"type":"code","lang":"python","executable":true,"value":"from sklearn.metrics import accuracy_score, confusion_matrix, classification_report, f1_score\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.datasets import load_breast_cancer\nfrom sklearn.linear_model import LogisticRegression\ndata = load_breast_cancer()\nX_train, X_test, y_train, y_test = train_test_split(\n    data.data, data.target, stratify=data.target, random_state=0)\nlr = LogisticRegression().fit(X_train, y_train)\ny_pred = lr.predict(X_test)\n\nprint(\"confusion_matrix(y_test, y_pred): \\n\", confusion_matrix(y_test, y_pred))\nprint(\"accuracy_score(y_test, y_pred): \", accuracy_score(y_test, y_pred))\nprint(\"model.score(X_test, y_test): \", lr.score(X_test, y_test))","key":"pyCgzX1WNS"},{"type":"outputs","id":"kft5ZDelQBlTbrlj7pYAc","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"confusion_matrix(y_test, y_pred): \n [[48  5]\n [ 5 85]]\naccuracy_score(y_test, y_pred):  0.9300699300699301\nmodel.score(X_test, y_test):  0.9300699300699301\n"},"children":[],"key":"pyOkmloQdb"}],"key":"FRc5UIGyYG"}],"key":"YzDXX2ULz2"},{"type":"block","kind":"notebook-code","data":{"hide_input":false,"slideshow":{"slide_type":"-"}},"children":[{"type":"code","lang":"python","executable":true,"value":"plt.rcParams['figure.dpi'] = 100 \nprint(classification_report(y_test, lr.predict(X_test)))","key":"IwbkiRpicW"},{"type":"outputs","id":"Uxl11kINm1VV8YJwzNs56","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"              precision    recall  f1-score   support\n\n           0       0.91      0.91      0.91        53\n           1       0.94      0.94      0.94        90\n\n    accuracy                           0.93       143\n   macro avg       0.93      0.93      0.93       143\nweighted avg       0.93      0.93      0.93       143\n\n"},"children":[],"key":"mIwkw5lwAO"}],"key":"UHIrVTOWug"}],"key":"eQofzprvKL"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"You can explictly define the averaging function for class-level metrics","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LoKDoq6qfj"}],"key":"P3u6NNCbp1"}],"key":"bixcJo7RhS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"pred = lr.predict(X_test)\nprint(\"Micro average f1 score: {:.3f}\".format(f1_score(y_test, pred, average=\"micro\")))\nprint(\"Weighted average f1 score: {:.3f}\".format(f1_score(y_test, pred, average=\"weighted\")))\nprint(\"Macro average f1 score: {:.3f}\".format(f1_score(y_test, pred, average=\"macro\")))","key":"WBs94m3cyO"},{"type":"outputs","id":"ydEMAYV8o5_XaxOJXdapK","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Micro average f1 score: 0.930\nWeighted average f1 score: 0.930\nMacro average f1 score: 0.925\n"},"children":[],"key":"FiocMmR8rT"}],"key":"cZlOcZzJGY"}],"key":"H28VJ6M9rg"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Probabilistic predictions","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MkylrwV9Ps"}],"identifier":"probabilistic-predictions","label":"Probabilistic predictions","html_id":"probabilistic-predictions","implicit":true,"key":"kdie13eQYA"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"To retrieve the uncertainty in the prediction, scikit-learn offers 2 functions. Often, both are available for every learner, but not always.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"dv40ph5zrg"}],"key":"SyiDQSBZvR"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"decision_function: returns floating point (-Inf,Inf) value for each prediction","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"v0InZHouTK"}],"key":"XtBD3BjTFT"}],"key":"paMHTg2Ays"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"predict_proba: returns probability [0,1] for each prediction","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Yxn7L39nnP"}],"key":"iIWkXB50Z9"}],"key":"HIcac8Jq7T"}],"key":"sOr0g86vkj"}],"key":"rEFZg7lltz"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"You can also use these to compute any metric with non-standard thresholds","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pDCJAZvgdM"}],"key":"SOU4jkcvWB"}],"key":"BkSMmJqO3c"},{"type":"block","kind":"notebook-code","data":{"hide_input":false},"children":[{"type":"code","lang":"python","executable":true,"value":"print(\"Threshold -0.8\")\ny_pred_lower_threshold = lr.decision_function(X_test) > -.8\nprint(classification_report(y_test, y_pred_lower_threshold))  ","key":"vKxR8Lcdwn"},{"type":"outputs","id":"XOaX2hJyMapu8SoqEr3cS","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Threshold -0.8\n              precision    recall  f1-score   support\n\n           0       0.94      0.89      0.91        53\n           1       0.94      0.97      0.95        90\n\n    accuracy                           0.94       143\n   macro avg       0.94      0.93      0.93       143\nweighted avg       0.94      0.94      0.94       143\n\n"},"children":[],"key":"FaC6eF3WoK"}],"key":"fb5MVxpglR"}],"key":"VfyxTe43gc"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Uncertainty in multi-class classification","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CCdubNX965"}],"identifier":"uncertainty-in-multi-class-classification","label":"Uncertainty in multi-class classification","html_id":"uncertainty-in-multi-class-classification","implicit":true,"key":"a4d3y2h5ZM"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"decision_function","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"t5cn3c2877"},{"type":"text","value":" and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fbbTCoPzPh"},{"type":"inlineCode","value":"predict_proba","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"bTsoGaPWeT"},{"type":"text","value":" also work in the multiclass setting","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Qk9v539G3H"}],"key":"X30A6lt0Gl"}],"key":"stEhnM1mXD"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"always have shape (n_samples, n_classes)","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"DSiQJJjIZs"}],"key":"QE2pXO3XMv"}],"key":"xUT9z9XAXN"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Example on the Iris dataset, which has 3 classes:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Q7wYBUIX0M"}],"key":"c1HQEizaPK"}],"key":"fxwPMllVa3"}],"key":"G8w2w6uJdm"}],"key":"npybxW0AgZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from sklearn.datasets import load_iris\n\niris = load_iris()\nX_train2, X_test2, y_train2, y_test2 = train_test_split(\n    iris.data, iris.target, random_state=42)\n\nlr2 = LogisticRegression()\nlr2 = lr2.fit(X_train2, y_train2)\n\nprint(\"Decision function:\\n{}\".format(lr2.decision_function(X_test2)[:6, :]))\n# show the first few entries of predict_proba\nprint(\"Predicted probabilities:\\n{}\".format(lr2.predict_proba(X_test2)[:6]))","key":"xLwji43F1W"},{"type":"outputs","id":"Wq-SRXtYW2LWdnGdLaDMr","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Decision function:\n[[ -3.03499211   2.29425161   0.7407405 ]\n [  5.91897372   3.09086147  -9.0098352 ]\n [-10.05185099   1.87457159   8.17727941]\n [ -2.73279105   2.03622549   0.69656555]\n [ -3.73730572   2.47556657   1.26173915]\n [  6.03557844   3.0345983   -9.07017674]]\nPredicted probabilities:\n[[3.98547105e-03 8.22130578e-01 1.73883951e-01]\n [9.44175894e-01 5.58237959e-02 3.10136994e-07]\n [1.20891186e-08 1.82799143e-03 9.98171996e-01]\n [6.68180705e-03 7.87139122e-01 2.06179071e-01]\n [1.54224758e-03 7.69786431e-01 2.28671321e-01]\n [9.52618137e-01 4.73816007e-02 2.62163802e-07]]\n"},"children":[],"key":"YA9tiHrZ0d"}],"key":"RikC8zV69o"}],"key":"tKGzWH4QlK"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Precision-Recall and ROC curves","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mtyVJHmMtS"}],"identifier":"precision-recall-and-roc-curves","label":"Precision-Recall and ROC curves","html_id":"precision-recall-and-roc-curves","implicit":true,"key":"CsdZFUaYC4"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"link","url":"https://scikit-learn.org/stable/modules/generated/sklearn.metrics.precision_recall_curve.html?highlight=precision_recall_curve","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"precision​_recall​_curve","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"R5DK47pbJ1"}],"urlSource":"https://scikit-learn.org/stable/modules/generated/sklearn.metrics.precision_recall_curve.html?highlight=precision_recall_curve","key":"Xk1u6sygD1"},{"type":"text","value":" returns all precision and recall values for all possible thresholds","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"tV9KezhDx0"}],"key":"b1zN0XXNWC"}],"key":"aMpwr6ZdEA"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"link","url":"https://scikit-learn.org/stable/modules/generated/sklearn.metrics.roc_curve.html?highlight=roc%20curve#sklearn.metrics.roc_curve","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"roc_curve","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Aczhj8d6IL"}],"urlSource":"https://scikit-learn.org/stable/modules/generated/sklearn.metrics.roc_curve.html?highlight=roc%20curve#sklearn.metrics.roc_curve","key":"ch1rh3X6d0"},{"type":"text","value":" does the same for TPR and FPR.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"A6onREmlEN"}],"key":"KGZESrsOxb"}],"key":"W9iy4bAO1s"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The average precision score is returned by the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"kq6fzHllKR"},{"type":"inlineCode","value":"average_precision_score","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"awkyCYxFYF"},{"type":"text","value":" measure","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"fIYtsfICvZ"}],"key":"TVXuTQKDPV"}],"key":"urTSv9lFu6"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"The area under the ROC curve is returned by the ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"FPxkgy8zOl"},{"type":"inlineCode","value":"roc_auc_score","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"ZmXJQZe1J4"},{"type":"text","value":" measure","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"qbV54q8LXw"}],"key":"AphUX49lJa"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Don’t use ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"QrRSLYzOhi"},{"type":"inlineCode","value":"auc","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"olZ1BGBduj"},{"type":"text","value":" (this uses a less accurate trapezoidal rule)","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"DpomAl492k"}],"key":"MM4JUDVE5k"}],"key":"ad0Oql9QMi"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Require a decision function or predict_proba.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"fnADpPHSaj"}],"key":"DVfaQ1YHLb"}],"key":"w1Iqd7Ab32"}],"key":"IfKVG4UYNU"}],"key":"A506XhFTiM"}],"key":"AOgByJL8Pm"}],"key":"wPPDw3WRVg"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from sklearn.metrics import precision_recall_curve\nprecision, recall, thresholds = precision_recall_curve(\n    y_test, lr.decision_function(X_test))","key":"SMASZttt3R"},{"type":"outputs","id":"rIKxcqHRCFA3LQKrZ8H-f","children":[],"key":"UBrJBaLeyD"}],"key":"EGdaBqoI5D"},{"type":"block","kind":"notebook-code","data":{"hide_input":true},"children":[{"type":"code","lang":"python","executable":true,"value":"from sklearn.metrics import average_precision_score\nap_pp = average_precision_score(y_test, lr.predict_proba(X_test)[:, 1])\nap_df = average_precision_score(y_test, lr.decision_function(X_test))\nprint(\"Average precision of logreg: {:.3f}\".format(ap_df))","key":"d5G4zEELEO"},{"type":"outputs","id":"cta-fG3BS4TUmee5dBalY","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Average precision of logreg: 0.995\n"},"children":[],"key":"b8cn5myoOq"}],"key":"QAYp0PzHB2"}],"key":"apWbEDAl9J"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from sklearn.metrics import roc_auc_score\nrf_auc = roc_auc_score(y_test, lr.predict_proba(X_test)[:, 1])\nsvc_auc = roc_auc_score(y_test, lr.decision_function(X_test))\nprint(\"AUC for Random Forest: {:.3f}\".format(rf_auc))\nprint(\"AUC for SVC: {:.3f}\".format(svc_auc))","key":"vxCAJBrLzs"},{"type":"outputs","id":"8mHp6JAnQj7vAGBq8qW5X","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"AUC for Random Forest: 0.991\nAUC for SVC: 0.991\n"},"children":[],"key":"KRJlyGBPH2"}],"key":"vrweMiKKoP"}],"key":"fC43DvaWX0"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Multi-class prediction","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"J9ttSsk1fj"}],"identifier":"multi-class-prediction","label":"Multi-class prediction","html_id":"multi-class-prediction","implicit":true,"key":"KG6UintHnF"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Build C models, one for every class vs all others","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"t1xLlFSDdb"}],"key":"dttiJhK3oJ"}],"key":"D0mfB2fiQT"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Use micro-, macro-, or weighted averaging","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"PElNoX1m2r"}],"key":"wYA1l7NG2w"}],"key":"wmXwF3tBWs"}],"key":"dMtCIkutEN"}],"key":"A65p5V0exi"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(\"Micro average f1 score: {:.3f}\".format(f1_score(y_test, pred, average=\"micro\")))\nprint(\"Weighted average f1 score: {:.3f}\".format(f1_score(y_test, pred, average=\"weighted\")))\nprint(\"Macro average f1 score: {:.3f}\".format(f1_score(y_test, pred, average=\"macro\")))","key":"Fn939EMlAM"},{"type":"outputs","id":"5QAJX6KZo83v5Gb68j2GH","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Micro average f1 score: 0.930\nWeighted average f1 score: 0.930\nMacro average f1 score: 0.925\n"},"children":[],"key":"mVVpvR99w8"}],"key":"pAEbRck7aa"}],"key":"hZuTWre5jc"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Using evaluation metrics in model selection","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UrNEowmzWD"}],"identifier":"using-evaluation-metrics-in-model-selection","label":"Using evaluation metrics in model selection","html_id":"using-evaluation-metrics-in-model-selection","implicit":true,"key":"nLFtHbqfVQ"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"You typically want to use AUC or other relevant measures in ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Wd3apzl0vc"},{"type":"inlineCode","value":"cross_val_score","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"UWY9QPhYDs"},{"type":"text","value":" and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"lkkhAcGrdd"},{"type":"inlineCode","value":"GridSearchCV","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"DSKpq4exPz"},{"type":"text","value":" instead of the default accuracy.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"WQxSndEL5J"}],"key":"wGceBvIoJ3"}],"key":"I3Z0ZSXsCJ"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"scikit-learn makes this easy through the ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"BDWccqnvjG"},{"type":"inlineCode","value":"scoring","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"XAuE6mNo2U"},{"type":"text","value":" argument","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"CIL9NDLWDh"}],"key":"qZakjwfcFX"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"But, you need to need to look the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"bd9tGDO6lX"},{"type":"link","url":"http://scikit-learn.org/stable/modules/model_evaluation.html#model-evaluation","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"mapping between the scorer and the metric","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"DT3PRl598I"}],"urlSource":"http://scikit-learn.org/stable/modules/model_evaluation.html#model-evaluation","key":"Wmb3uqwAQN"}],"key":"MIAFKzrRX1"}],"key":"AfHDWQVPs2"}],"key":"WDVjtro9m6"}],"key":"GY9gx7D31P"}],"key":"AeHFHqy4az"}],"key":"ntGQW0XLQa"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"image","url":"/4829f5b2dbbf245223508638b687a2c0.png","alt":"scorers","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ucr5CUJLWG","urlSource":"https://raw.githubusercontent.com/ML-course/master/master/notebooks/images/03_scoring.png","urlOptimized":"/4829f5b2dbbf245223508638b687a2c0.webp"}],"key":"fprtKEb9kx"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Or simply look up like this:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NvYZh3sU5r"}],"key":"O5SZUrksNS"}],"key":"dAmvr0HCpW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from sklearn.metrics import SCORERS\nprint(\"Available scorers:\\n{}\".format(sorted(SCORERS.keys())))","key":"pYbBvTrLMo"},{"type":"outputs","id":"kdJZsIbBAz7L7-xjUvDhh","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Available scorers:\n['accuracy', 'adjusted_mutual_info_score', 'adjusted_rand_score', 'average_precision', 'balanced_accuracy', 'completeness_score', 'explained_variance', 'f1', 'f1_macro', 'f1_micro', 'f1_samples', 'f1_weighted', 'fowlkes_mallows_score', 'homogeneity_score', 'jaccard', 'jaccard_macro', 'jaccard_micro', 'jaccard_samples', 'jaccard_weighted', 'max_error', 'mutual_info_score', 'neg_brier_score', 'neg_log_loss', 'neg_mean_absolute_error', 'neg_mean_absolute_percentage_error', 'neg_mean_gamma_deviance', 'neg_mean_poisson_deviance', 'neg_mean_squared_error', 'neg_mean_squared_log_error', 'neg_median_absolute_error', 'neg_root_mean_squared_error', 'normalized_mutual_info_score', 'precision', 'precision_macro', 'precision_micro', 'precision_samples', 'precision_weighted', 'r2', 'rand_score', 'recall', 'recall_macro', 'recall_micro', 'recall_samples', 'recall_weighted', 'roc_auc', 'roc_auc_ovo', 'roc_auc_ovo_weighted', 'roc_auc_ovr', 'roc_auc_ovr_weighted', 'top_k_accuracy', 'v_measure_score']\n"},"children":[],"key":"wMwNjxU4p3"}],"key":"umKDng31or"}],"key":"gi5xc3XdoB"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Cross-validation with AUC","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"y1RIR4ANw5"}],"key":"AAH1bV3GcZ"}],"key":"U7Ho41qYo3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from sklearn.model_selection import cross_val_score, GridSearchCV\nfrom sklearn .svm import SVC\nfrom sklearn.datasets import load_digits\ndigits = load_digits()\n\n# default scoring for classification is accuracy\nprint(\"Default scoring: {}\".format(\n      cross_val_score(SVC(), digits.data, digits.target == 9)))\n# providing scoring=\"accuracy\" doesn't change the results\nexplicit_accuracy =  cross_val_score(SVC(), digits.data, digits.target == 9, \n                                     scoring=\"accuracy\")\nprint(\"Explicit accuracy scoring: {}\".format(explicit_accuracy))\nroc_auc =  cross_val_score(SVC(), digits.data, digits.target == 9,\n                           scoring=\"roc_auc\")\nprint(\"AUC scoring: {}\".format(roc_auc))","key":"f7fEMtyhyc"},{"type":"outputs","id":"4zT9ph9Ma2rHDtBoJ6xrV","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Default scoring: [0.975      0.99166667 1.         0.99442897 0.98050139]\nExplicit accuracy scoring: [0.975      0.99166667 1.         0.99442897 0.98050139]\nAUC scoring: [0.99717078 0.99854252 1.         0.999828   0.98400413]\n"},"children":[],"key":"kxfEpQHLGs"}],"key":"HERjESNG5f"}],"key":"bfAsYgZQEu"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Hyperparameter tuning","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HBPVTeJ67B"}],"identifier":"hyperparameter-tuning","label":"Hyperparameter tuning","html_id":"hyperparameter-tuning","implicit":true,"key":"huAdknYbuM"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Now that we know how to evaluate models, we can improve them by tuning their hyperparameters","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"X4OTHQ8kyv"}],"key":"VOJujdXFoV"}],"key":"thPS4XxMK1"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Grid search","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qGJgZdAoG6"}],"identifier":"grid-search","label":"Grid search","html_id":"grid-search","implicit":true,"key":"mIiyyMBvV2"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Create a parameter grid as a dictionary","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"tf721d9mCr"}],"key":"IbLGeVcfzY"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Keys are parameter names","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"XeUVGMFJyr"}],"key":"X8Gr1vMU00"}],"key":"vLul11BhB7"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Values are lists of hyperparameter values","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"y3ZSyIwbrl"}],"key":"jMWq58F6Tm"}],"key":"vzJo5aDFdI"}],"key":"pGzlwt6rRj"}],"key":"MtYa70ND7n"}],"key":"icnwcOz5hL"}],"key":"N4aDwdhlr1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"param_grid = {'C': [0.001, 0.01, 0.1, 1, 10, 100],\n              'gamma': [0.001, 0.01, 0.1, 1, 10, 100]}\nprint(\"Parameter grid:\\n{}\".format(param_grid))","key":"z9AXJODOwo"},{"type":"outputs","id":"994pkapXMd6n4n2P9xZz0","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Parameter grid:\n{'C': [0.001, 0.01, 0.1, 1, 10, 100], 'gamma': [0.001, 0.01, 0.1, 1, 10, 100]}\n"},"children":[],"key":"UsiqSFuNu4"}],"key":"FpGj6nnZXc"}],"key":"RlfiIANNXl"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"GridSearchCV","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vPyRuXNNfw"},{"type":"text","value":": like a classifier that uses CV to automatically optimize its hyperparameters internally","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"oXcOjUfje9"}],"key":"k271tUCdOt"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Input: (untrained) model, parameter grid, CV procedure","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"dQf2Ofbae5"}],"key":"RqCsD39tqz"}],"key":"TtqQe5cUTS"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Output: optimized model on given training data","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"TqWcwCWZ16"}],"key":"PtUGIt8S7W"}],"key":"xjsCFHnuyL"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Should only have access to training data","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"xxSFjER2R3"}],"key":"ADfSETiNYA"}],"key":"KTy4vxcpkZ"}],"key":"MNoiAWc2WE"}],"key":"bk9qzx8UEf"}],"key":"ujbrdSQu7A"}],"key":"Oie3e8iibB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from sklearn.model_selection import GridSearchCV \nfrom sklearn.svm import SVC\ngrid_search = GridSearchCV(SVC(), param_grid, cv=5)\nX_train, X_test, y_train, y_test = train_test_split(\n        iris.data, iris.target, random_state=0)\ngrid_search.fit(X_train, y_train)","key":"wwp8PjujRq"},{"type":"outputs","id":"RhO6Upma8UpNj7gfeDy1o","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":20,"metadata":{},"data":{"text/plain":{"content":"GridSearchCV(cv=5, estimator=SVC(),\n             param_grid={'C': [0.001, 0.01, 0.1, 1, 10, 100],\n                         'gamma': [0.001, 0.01, 0.1, 1, 10, 100]})","content_type":"text/plain"}}},"children":[],"key":"p341n0P7AN"}],"key":"wZ48SjVSZH"}],"key":"ZslN509H3A"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The optimized test score and hyperparameters can easily be retrieved:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Yuvi10v7Ix"}],"key":"HgFmeIKgsg"}],"key":"t7CBJS5VSP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(\"Test set score: {:.2f}\".format(grid_search.score(X_test, y_test)))","key":"MWB6FW4i4y"},{"type":"outputs","id":"-iAOX4jzis7QLvorY54gm","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Test set score: 0.97\n"},"children":[],"key":"uZEunCLzBp"}],"key":"udF6uCcHG8"}],"key":"nZI4ddnfil"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(\"Best parameters: {}\".format(grid_search.best_params_))\nprint(\"Best cross-validation score: {:.2f}\".format(grid_search.best_score_))","key":"Klodbck7GA"},{"type":"outputs","id":"OPNFiuH9r0MnIlKnRHG7T","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Best parameters: {'C': 10, 'gamma': 0.1}\nBest cross-validation score: 0.97\n"},"children":[],"key":"t1vAVpV1FP"}],"key":"b1mCKepURd"}],"key":"brRXErqIAv"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(\"Best estimator:\\n{}\".format(grid_search.best_estimator_))","key":"gARaJZNZ0K"},{"type":"outputs","id":"aKK-2Y6UCuPuXoRwnUo2E","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Best estimator:\nSVC(C=10, gamma=0.1)\n"},"children":[],"key":"YbmhpZXKpY"}],"key":"pkFyMrOWcA"}],"key":"PP5Z0uf9YP"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"When hyperparameters depend on other parameters, we can use lists of dictionaries to define the hyperparameter space","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sYOtkPcxfo"}],"key":"kfghu3kga9"}],"key":"DKlXxqTmQU"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"param_grid = [{'kernel': ['rbf'],\n               'C': [0.001, 0.01, 0.1, 1, 10, 100],\n               'gamma': [0.001, 0.01, 0.1, 1, 10, 100]},\n              {'kernel': ['linear'],\n               'C': [0.001, 0.01, 0.1, 1, 10, 100]}]\nprint(\"List of grids:\\n{}\".format(param_grid))","key":"Ut4eZYWZcj"},{"type":"outputs","id":"MdFnw3DaPyS40iCP5BAlj","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"List of grids:\n[{'kernel': ['rbf'], 'C': [0.001, 0.01, 0.1, 1, 10, 100], 'gamma': [0.001, 0.01, 0.1, 1, 10, 100]}, {'kernel': ['linear'], 'C': [0.001, 0.01, 0.1, 1, 10, 100]}]\n"},"children":[],"key":"UzS5dQ1xfs"}],"key":"MwJHnrmBu4"}],"key":"KQNZPfFJxH"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Nested cross-validation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LedtgOs3UQ"}],"identifier":"nested-cross-validation","label":"Nested cross-validation","html_id":"nested-cross-validation","implicit":true,"key":"RaesrTsmVr"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Nested cross-validation:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"C517woxKBG"}],"key":"D35RKjOI9z"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Outer loop: split data in training and test sets","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"tYJ88GVCrI"}],"key":"sEIsaAdbbn"}],"key":"tpynObkEM9"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Inner loop: run grid search, splitting the training data into train and validation sets","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"qcLYhqZmuK"}],"key":"PVGcxzZWc0"}],"key":"pllsYEN24n"}],"key":"Kvx3oKl8uy"}],"key":"NqLnSGZIJc"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Result is a just a list of scores","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"UGWxkGzjyY"}],"key":"W56aro2xjG"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"There will be multiple optimized models and hyperparameter settings (not returned)","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"bUInU5QLoo"}],"key":"GHtG3JZGfl"}],"key":"Xkgwj0QX6w"}],"key":"lRTt1XINRv"}],"key":"sgpwTEPeJ6"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"To apply on future data, we need to train ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"HWuHdkPdQe"},{"type":"inlineCode","value":"GridSearchCV","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"c2zXtchT2A"},{"type":"text","value":" on all data again","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"XzLTqmVtuU"}],"key":"KJ4ABFF7pK"}],"key":"hsGc54P6Jy"}],"key":"TKLkLztxTa"}],"key":"oa7OlzbpAj"},{"type":"block","kind":"notebook-code","data":{"slideshow":{"slide_type":"-"}},"children":[{"type":"code","lang":"python","executable":true,"value":"scores = cross_val_score(GridSearchCV(SVC(), param_grid, cv=5),\n                         iris.data, iris.target, cv=5)\nprint(\"Cross-validation scores: \", scores)\nprint(\"Mean cross-validation score: \", scores.mean())","key":"D8SB0MwajR"},{"type":"outputs","id":"Awj0KRySnmvUywVVP31nq","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Cross-validation scores:  [0.96666667 1.         0.9        0.96666667 1.        ]\nMean cross-validation score:  0.9666666666666668\n"},"children":[],"key":"OcQUqN7itN"}],"key":"tTywgLN7DP"}],"key":"XV14KJnkCk"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Parallelizing cross-validation and grid-search","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zcWdeDJ4Jw"}],"identifier":"parallelizing-cross-validation-and-grid-search","label":"Parallelizing cross-validation and grid-search","html_id":"parallelizing-cross-validation-and-grid-search","implicit":true,"key":"PFKCILumLH"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"On a practical note, it is easy to parallellize CV and grid search","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"eCGpyZEJ4E"}],"key":"BDg7qXiVKN"}],"key":"s8kDYhgCZa"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"cross_val_score","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wsrmtn4ZXv"},{"type":"text","value":" and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"QayipBT9NM"},{"type":"inlineCode","value":"GridSearchCV","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"UH2UqtGY8p"},{"type":"text","value":" have a ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"l7OnqHkiEi"},{"type":"inlineCode","value":"n_jobs","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"nqzGnPRKxB"},{"type":"text","value":" parameter defining the number of cores it can use.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dgYSDXUy1v"}],"key":"P5CyUBpRZu"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"set it to ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"VgHFCN9map"},{"type":"inlineCode","value":"n_jobs=-1","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"LuyxOBslr5"},{"type":"text","value":" to use all available cores.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"WwhacGfC4L"}],"key":"CVpkp9H7s9"}],"key":"rcLFFMvxup"}],"key":"Sj0LrwJfF7"}],"key":"avtRZR50c9"}],"key":"QVXXzIX1W9"}],"key":"HnCcox7lJS"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"}},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Random Search","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jR4Cwuda7e"}],"identifier":"random-search","label":"Random Search","html_id":"random-search","implicit":true,"key":"lsfbOJg077"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"RandomizedSearchCV","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"bcQCmHA0HH"},{"type":"text","value":" works like ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"eQXiCANHPO"},{"type":"inlineCode","value":"GridSearchCV","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"H2cfZim7td"}],"key":"kY0XqVUU6w"}],"key":"p47PaGN960"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Has ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ANb77D7cXM"},{"type":"inlineCode","value":"n_iter","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"YfwJE9npps"},{"type":"text","value":" parameter for the number of iterations","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"u5KCIxbqSD"}],"key":"hGrQjX6Spr"}],"key":"AeG3rHsvc7"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Search grid can use distributions instead of fixed lists","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"wfUgfOx32p"}],"key":"vsrXNaIQL4"}],"key":"wmECjOOyWD"}],"key":"jZrWAcHzju"}],"key":"eAWxhkXxll"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from sklearn.model_selection import RandomizedSearchCV\nfrom scipy.stats import expon\n\nparam_grid = {'C': expon(scale=100), \n              'gamma': expon(scale=.1)}\nrandom_search = RandomizedSearchCV(SVC(), param_distributions=param_grid,\n                                   n_iter=20)\nX_train, X_test, y_train, y_test = train_test_split(\n        iris.data, iris.target, random_state=0)\nrandom_search.fit(X_train, y_train)","key":"DtcZiCIlb0"},{"type":"outputs","id":"NI077y9_HKwkUKc7r3lGr","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":26,"metadata":{},"data":{"text/plain":{"content":"RandomizedSearchCV(estimator=SVC(), n_iter=20,\n                   param_distributions={'C': <scipy.stats._distn_infrastructure.rv_frozen object at 0x282abbc40>,\n                                        'gamma': <scipy.stats._distn_infrastructure.rv_frozen object at 0x2824ad1f0>})","content_type":"text/plain"}}},"children":[],"key":"FUDq3FrnBQ"}],"key":"FWiyL7jc1O"}],"key":"yxw8m4Acv4"}],"key":"kCpNtVirrU"},"references":{"cite":{"order":[],"data":{}}}}